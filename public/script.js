let jp = [
[0, -3, -2, -1, 1, 2, 3, -4, 4, 5, 6, 7, 4, 4.5, 9, 10, 11],
[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1.5, 1.5, 1, 1, 1],
[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 9, 9, 1, 1, 6],
  

[0,1,2,3,7,6,4.5,5],
[1,1,1,1,1,1,3,3],
[1,1,1,1,6,1,9,9],
  

  
[1,-1,0,1,2,4,5,6,8,9,9.5,10,13,16,17,18,21,25,28,29,30],  
[1,0,0,0,0,0,0,1,2,3,3,2,2,1,3,5,5,0,0,0,0],
[9,1,1,1,1,1,1,1,1,9,9,1,1,1,1,1,1,1,1,1,6],
  
  
[0,1,5,5,9,13,17,21,22,23,24,28,29,30,31,32,33,34,32,30,30,32,26,9,13,17],
[ 0, 0, 0, 1, 0, 0, 0, 0, 1, 2, 3, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 2, 1, 2, 2, 1 ],
[1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,6,3,3,9,9,1,9,9,9],
  
  
[0,1,2,3,4,4.5,4.5,4.5,4.5,12,13],
[1,1,1,1,1,1.5,2,2.5,3,1,1],
[1,1,1,1,4,9,9,9,9,1,6],
  

  
[0,1,2,3,4,5,6,7,8,7,1,1,11,11,11,11,12,14,15,16,14,14,14,15,16,16,16,18,18,18,18,19,19],
[0,0,-4,-5,-5,-5,-4,0,0,1,1,2,2,1,0,-1,-1,2,2,2,1,0,-1,-1,-1,0,1,2,1,0,-1,-1,2],
[1,1,1,1,1,1,4,1,1,3,3,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,3],
  

  
[0,1,2,7,12,2.5,7,8,11.5,13.5,16,17,18],
[1,1,1,1,1,1.5,1.5,1.5,1.5,1.5,1.5,1,1],
[1,1,1,1,1,9,9,9,9,9,9,1,6],
  

  
[0,1,3,5,7,2,4,6,1,2,4,3,6,5,7,8,1,2,3,4,5,6,7,2,4,6,8.5],
[1,1,1,1,1,1,1,1,4,4,4,4,4,4,4,1,5,5,5,5,5,5,5,2,2,2,5],
[1,4,4,4,4,1,1,1,1,1,1,1,1,1,1,6,3,3,3,3,3,3,3,3,3,3,9],
  

 
[-1,0,1,4,7,10,11,12,14.5,15,16.5,18,19,20,22,25,30,33,36,37,38,40,40,40.5,41,42,43,46],
[0,0,0,0,0,0,0,1,1,0,1,1,0,1,2,3,0,1,0,-1,-3,-5,-4.5,-4.5,-3,-1,-1,0],
[1,1,1,1,1,2,2,9,9,2,9,9,2,2,2,2,2,2,2,2,2,2,9,9,2,2,2,6],
  

  
[0,1,5,2.5,4,6.5,8,9,13,14,15,19,23,14,19,24,25,24,29],
[1,1,1,1.5,1.5,1.5,1.5,1,1,1,1,1,1,2,2,1,1,2,1],
[2,2,2,9,9,9,9,2,2,2,2,2,2,3,10,2,2,3,6],
  

 
[0,3,4,6,6,4,6,4,6,5,6,9,10,8],
[1,-2,-3,4,5,7,8,8,6,9,9,0,3,7],
[1,1,4,1,1,1,1,3,3,9,3,1,1,6],
  


  
[0,1,2,3,4,5,6,8.5,8.5,8.5,8.5,9,9,9,9,9.5,9.5,9.5,9.5,9,9,9,9,8.5,8.5,8.5,8.5,8],
[1,1,7,7,13,13,19,21,20.5,20,19.5,19,18.5,18,17.5,17,16.5,16,15.5,15,14.5,14,13.5,13,12.5,12,11.5,1],
[1,4,1,4,1,4,1,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6],
  

  
[0,-1,5,2,10,5,11,11,11,11,11,11,10,10,10,10,10,13,16,16,18,18,18,18,20,20,16,13,13,13,11,7,3,11,11.5],
[1,1,-3,-6,-6,-2,5,4,3,2,1,0,1,2,3,4,0,1,4,5,4,3,2,5,1,2,-5,2,3,4,9,9,8,13,13],
[1,1,1,6,4,9,2,2,2,2,2,2,9,9,9,9,9,1,1,9,2,2,2,3,1,9,4,11,11,11,2,2,2,9,9],
 
  
[0,9,8,9,8,9,8,9,8,9,8,8,9,8,9,8,9,8,9,8,3,13,13,13,11,10,9,8,7,12,14,13,2,-4,-3.5],[1,6,5,4,3,2,1,0,-1,-2,-3,6,5,4,3,2,1,0,-1,-2,-7,10,9,8,9,9,9,9,9,9,3,11,9,9,9.5],[1,1,1,1,1,1,1,1,1,1,1,9,9,9,9,9,9,9,9,9,4,2,2,2,1,1,1,1,1,1,4,3,4,6,9],

  
[0,3,8,10,11,11,11,12,-6,-6,-6,-6,-6,-6,-6,-6,-2,14,-6,-5,-5,-5,-5,-5,-5,-5,-10,3,-2,8,10,12,15,15,15,15,15,15,15,15,15,15,14,14,14,14,14,14,-10,-10,-11,15,12,11,10,9,7,8,6,4,5,3,2,1,11,10,9,8,7,6,5,4,3,2,1.5,12,5,4,1,1,1,1,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-6,-6],[1,1,-3,4,3,2,1,0,6,5,4,3,2,1,0,-1,-4,-2,7,5,4,3,2,1,0,-1,-5,2,-3,-2,5,1,8,7,6,5,4,3,2,1,0,-1,-1,0,1,2,3,4,-4,2,2,9,8,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,7.5,7.5,9,9,9,8,9,10,11,11,10,9,8,7,11,10,9,8,7,12,-6,-7],[1,4,4,4,1,1,1,2,2,2,2,2,2,2,2,2,4,2,3,9,9,9,9,9,9,9,1,9,9,9,9,9,2,2,2,2,2,2,2,2,2,2,3.4,3.4,3.4,3.4,3.4,3.4,9,6,6,3,4,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,1,1,4,9,9,9,9,9,3.2,3.2,3.2,3.2,3.4,3.4,3.4,3.4,3.4,2,2,2,2,2,3,4,4],
  
  
[0,1,2,3,4,6,7,8,10,11,12,13,2,6,8,2,6,8,10,13,-1,-5,-5,-4,15],
[0,0,0,0,0,2,2,2,-1,-2,-3,-2,-5,-4,-2,-4,-3,-1,0,-1,0,5,6,5,0],
[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,9,9,9,9,9,4,1,10,1,6],



  
[0,5,5,9,10,11,12,13,14,15,16,16,16,8,16,16,16,16,15,14,13,13,13,13,13,13,13,27,24,28,28,8,8,8,8,8,8,6,5,4,3,2,3,4,5,6,8],[1,1,0,1,1,1,1,2,3,4,5,6,7,2,8,9,10,11,11,12,12,10,13,14,15,16,17,11,11,11,12,13,12,11,10,9,8,13,13,13,13,13,14,14,14,14,14],[1,4,2,1,1,1,1,1,1,4,1,1,1,1,1,1,1,4,1,1,1,2,1,1,1,1,1,4,7,2,9,2,2,2,2,2,2,2,2,2,2,6,9,9,9,9,3],

[0,0,1,2,3,4,5,5,5,5,5,5,5,6,6,6,6,6,6,6,7,8,9,10,11,12,13,14,14,14,14,14,14,15,15,15,15,15,15,15,14,5,6,6,7,8,9,10,11,12,13,8,8,7,9,11,10,10,12,13,14,14,14,13,12,11,10,9,8,7,7,8,9,10,11,12,13,13,12,11,10,9,8,7,9,10,11,12,13,13,12,11,10,9,7,8,7,8.5,7,7.5,8,8.5,6,6,7,8,9,10,11,12,13,13,12,11,10,9,7,7,8,9,14.5,14,13.5,13,12.5,12,10,11,12,13,6,8,9,14,13,10,11,7,8,12,13,10,6,8,7,9,11,13,12,14,9,10,11,12,13,14,6,6],[1,1,1,1,1,1,7,6,5,4,3,2,1,13,12,11,10,9,8,1,1,1,1,1,1,1,1,13,12,11,10,9,8,7,6,5,4,3,2,1,1,8,14,19,14,14,14,14,14,14,14,17,18,18,17,16,16,17,16,16,16,15,14,13,13,13,13,13,13,13,12,12,12,12,12,12,12,11,11,11,11,11,11,11,10,10,10,10,10,9,9,9,9,9,9,9,11.5,11.5,10.5,10,10,10.5,-5,-5.5,8,8,8,8,8,8,7,8,7,7,7,7,7,6,6,6,1.5,1.5,1.5,1.5,1.5,1.5,6,6,6,6,5,5,5,5,5,5,5,4,4,4,4,4,3,3,2,2,3,3,3,3,3,2,2,2,2,6,6,4],[2,2,2,2,2,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,4,4,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.4,3,3,3,3,3.4,3,3,3,3,3.4,3.4,3.3,3.3,3.3,3.3,3.3,3.3,3.2,3.3,3.3,3.3,3.3,3.3,3.3,3.4,3.3,3.3,3.3,3.3,3.2,3.3,3.3,3.3,3.3,3.3,3.3,3.4,3.3,3.3,3.3,3.3,3.3,3.2,3.3,9,9,9,9,9,9,9,9,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.4,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,9,9,9,9,9,9,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3.3,3,3.3,3.3,3.3,3,3.4,3.2,3.3,3.3,3.3,3.4,3.2,3.2],
  
[0,4,4,4,4,4,4,6,7,9,10,11,13,10,11,12,15,16,17,17,15,15,17,17,15,15,15,4,9,10,11,11,12,15,17,5,5,10,17,16,10,13],
[1,1,0,-1,5,4,3,6,6,6,6,6,6,0,0,0,-4,-4,-1,-2,0,-1,2,1,5,4,3,6,7,7,7,1,1,1,0,4,3,1,3,-3,2,7],
[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,9,9,9,9,9,4,6],


  
[0,2,2,2,2,2,0,1,2,3,5,3,4,5,6,5,7,7,7,9,10,11,11,9,11,9,10,-1,11,0,3],[1,1,0,-2,-1,2,-3,-4,-4,-4,-1,1,1,1,1,-0.5,0,1,-3,-3,-5,-4,-2,-2,-1,0,-4.5,1,-3,2,3],[1,1,3.4,1,3.4,9,1,1,1,4,1,1,1,1,1,9,3.4,1,3.4,1,4,1,1,3,3,7,9,6,3.4,9,9],
  

  
[0,5,5,10,10,4.5,6,9.5,11,14],
[1,1,4,1,4,1,1,1,1,1],
[1,1,3,1,3,9,9,9,9,6],
  
  
[0,5,5,6,7,0],
[1,-4,-2,-0.2,0,-1.2],
[1,1,9,7,1,6],
  


  
[0.96,1,0,0.5,1,5,9],
[1,2,1,1.5,1,1,1],
[6,3,1,9,1,7,6],

[0,-1,-2,-2,-2,1,1,1,0,0,0,-3,1,-1,-1,-1,0,0,3,3,6,-1,0,2,1,-0.5,0,0.5,1,6.5,12,11,13,14,15,16,17,18,19,20,21,22,23,24,14,16,18,19,21,22,23,24,25,26,27,28,28,27,27,27,28.5,26,2,3,2,3,28,29,30,31,32,30,31.5,38,37],[1,1,2,3,4,2,3,4,4,3,2,4,5,4,3,2,-2,-1,-2,-4,-2,-7,-7,-7,-7,-6.5,-6.5,-6.5,-6.5,-1.5,-2,-2,-2,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-3,-2,-2,-2,-2,-2,-2,-2,-2,-3,-3,-3,-2,-1,0,-1,-2,-0.5,3,4,4,5,5,7,7,7,7,7,8,7.5,7,7],
[1,1,1,1,1,1,1,1,3.4,3.4,3.4,5,3,3.2,3.2,3.2,1,10,7,7,1,2,2,2,2,9,9,9,9,9,1,3.4,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,11,1,1,1,1,1,11,3.4,3.4,9,1,1,1,3,3,1,1,1,1,1,10,9,6,3.4],
[0,0.5,2,2,0,2,0,0,1,2,3,2.5,2.5,4,4,4,4,2,3,2,3,4,5,6,6,6,6,5,6,7,4.5,6,6,6,4.5,5.5,7,8,8,8,9,9,9,10,11,12,13,9.5,10,11,11,11.5,12,13,13,14,14,15,15,16,15,15,16,17,17,17,15.5,18,18,18,18,18],[1,0.5,0.5,1,0,0,-1,-2,-2,-2,-2,-0.5,-2,-0.5,-2,-1,0,2,2,3,3,3,3,3,2,1,0,-2,-2,-2,0,0,-0.5,-2,-0.5,2,3,3,-2,2.5,3,2,-2,-2,-2,-2,-2,1.5,2,2,1,0.5,1,1,2,2,-2,2,1,2,-1,-2,-2,2,-2,-1,1.5,1,0,-1,2,-2],[1,20,20,1,1,1,1,1,1,1,1,20,20,20,1,1,1,1,3.3,1,1,1,1,1,1,1,1,1,1,1,20,20,20,20,20,9,1,1,1,21,1,1,1,1,1,1,1,21,1,1,1,21,1,1,1,1,1,1,1,1,1,1,1,1,1,6,21,3.2,3.2,3.2,1,1]

];

let jsm = [
  [0,-1,-2,-3,-4,1,2,3,-4,-3,-2,-1,1,0,2,3,-4,-4,-4,-4,-4,-3,-3,-3,-3,-3,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,-4,-3,-2,-4,-3,-2,-1,0,-1,0,1,3,2,3,3,3,2,1,0,1,2,2.5,-4,-4,-4,-3,-3,-3,-2,-2,-2,-1,-1,-1,0,0,0,1,1,1,2,2,2,3,3,3,-4,-3,-2,-1,0,1,2,3,2,4,5,6,7,8,9,10,4,4,4,4,4,4,5,5,5,5,5,6,6,6,7,8,10,9,8,7,6,5,4,12,16,17,12,16,17,20,20,24,25,26,27,28,29,30,31,32,33,34,26,27,28,28,28,29,29,29,29,30,30,30,30,31,31,31,31,32,32,33,25,27,28,30,32,34,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,25,25,25,25,25,26,26,26,26,26,28,29,31,32,33,33,33,33,33,33,33,30,33,33,33,32,31,30,28,33,33,33,30,30,33,33,33,33,33,33,33,32,31,28,29,31,32,35,35,35,35,35,34,34,34,29.5,32,28.5,32.5,32.5,28,28,-2,-2.5,-3,0,0.5,41,42,43,43,44,44,44,42,44,44,44,43,47,47,47,47,47,47,44,44,44,45,46,47,44,44,47,48,48,45,46,47,44,46,48,47,48,48,42,43,44,41,47,46,45,52,53,59,60,53,52,53,60,59,56,56,47,47,47,47,47,47,50,51,52,53,54,53,52,53,51,52.5,60.5,66,63,55,56,54,54,54,55,59,67,68,69,70,71,72,73,68,69,70,70,71,71,72,72,72,73,73,73,67,68,69,69,70,70,70,72,72,68,72,71,72,73,73,73,73,74,74,74,74,74,74,74,74,74,74,71,72,73,74,74,72,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,83,83,83,83,83,83,83,83,83,83,83,83,83,84,85,86,87,88,83,83,83,83,83,84,85,86,84,85,86,87,85,96,93,92,91,91,92,85,92,81,82,81,82,82,81,82,82,81,82.5,81,82.5,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,82,81,81,34,34,33,31,31,31,31,30,30,30,30,30,29,29,29,29,28,27,28,29,30,31,32,28,29,30,31,32,28,29,30,31,32,28,29,31,32,28,29,30,31,32,28,29,30,31,32,29,28,29,31,32,28,29,30,31,32,28,29,30,31,32,28,29,30,31,32,28,29,31,32,28,29,30,31,32,28,29,30,31,32,28,29,30,28,29,30,31,32,30,31,32,28,29,30,31,32,28,29,30,27,33,28,29,30,31,32,27,28,29,30,31,32,33,32],
  [1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,-1,-2,-3,-4,-5,-1,-2,-3,-4,-5,-1,-2,-3,-4,-5,-1,-2,-3,-4,-5,-1,-2,-3,-4,-5,-1,-2,-3,-4,-5,-1,-2,-3,-4,-5,-1,-2,-3,-4,-5,-9,-9,-9,-6,-6,-6,-6,-6,-9,-9,-9,-9,-9,-8,-7,-6,-6,-6,-7,-7,-7,-8.5,-10,-11,-12,-10,-11,-12,-10,-11,-12,-10,-11,-12,-10,-11,-12,-10,-11,-12,-10,-11,-12,-10,-11,-12,-13,-13,-13,-13,-13,-13,-13,-13,1.5,1,1,1,1,1,1,1,-5,-4,-3,-2,-1,0,-4,-3,-2,-1,0,-2,-1,0,0,0,0,0,-1,-1,-3,-5,-6,1,1,1,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,-1,-2,0,-1,-2,-3,0,-1,-2,-3,0,-1,-2,-3,0,-1,0,0,-1,-3,-4,-2,0,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,27,26,25,24,23,27,26,25,24,23,23,23,23,23,23,22,21,20,19,18,17,19,16,15,14,16,16,16,16,13,12,11,11,15,10,9,8,7,6,5,4,4,4,6,6,8,8,27,26,25,24,23,27,26,25,1.5,4.5,6.5,13,16.5,16.5,23.5,-9,-9,-9,-9,-9,1,1,1,0,1,0,-1,0,-2,-3,-4,-1,1,0,-1,-2,-3,-4,-5,-8,-8,-8,-8,-8,-6,-7,-5,-5,-8,-9,-9,-9,-9,-10,-9,-10,-6,-4,2,2,2,0,2,0,-4,-6,-6,-2,-2,-7,-7,-8,-3,-3,-4,-3,8,7,6,5,4,3,8,8,8,8,8,7,7,6,7,8.5,-1.5,-2,-2,8,8,7,6,5,7,8,-2,-1,-1,0,1,3,5,-2,-2,-1,-2,0,-2,2,1,-2,4,3,2,-3,-3,-3,-4,-3,-4,-5,-4,-5,-4,0,-5,-6,-4,-5,-6,-7,4,3,2,1,0,-2,-3,-4,-5,-6,-6,-7,-8,-7,-8,-1.5,10,9,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,10,9,8,7,6,5,4,3,2,1,0,-1,-2,-1,-1,-1,-2,-2,-3,-4,-5,-6,-7,-2,-2,-2,-3,-3,-3,-3,-4,-6,-6,-6,-6,-7,-7,-0.5,-5.5,10,10,9,9,8,4,-1,-7,7.5,3.5,-1.5,-6.5,8,8,7,7,6,6,5,5,4,4,3,3,2,2,1,1,0,0,-1,-1,-2,-2,-3,-3,-4,-4,-5,-5,-6,-6,-7,-8,24,23,24,24,25,26,27,27,26,25,24,23,27,26,25,24,24,24,22,22,22,22,22,21,21,21,21,21,20,20,20,20,20,19,19,19,19,18,18,18,18,18,17,17,17,17,17,16,15,15,15,15,14,14,14,14,14,13,13,13,13,13,12,12,12,12,12,11,11,11,11,10,10,10,10,10,9,9,9,9,9,8,8,8,7,7,7,7,7,6,6,6,5,5,5,5,5,4,4,4,3,3,3,3,3,3,3,2,2,2,2,2,2,2,24],
  [1,1,1,1,1,1,1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.5,1.5,1.5,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.5,1.5,100,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.5,1.5,1.5,1.5,1.5,1.5,1.5,101,1,1,1,1,1,1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.5,1.5,1.5,1.5,1.5,1.5,1,1,1,1.5,1.5,1.5,1,1.5,1,1,1,1,1,1,1,1,1,1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.5,1.5,1.5,1.5,1.5,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,102,103,104,105,106,107,108,20,20,20,20,20,1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.1,1.1,1.1,1.5,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.5,1.5,1.5,1.5,1,1,1,1,1.5,1,3,3,1,1,1,1,1.1,1.5,1.5,1.5,1.5,1.5,1,3.4,3.4,3.4,3.4,3.4,3.4,1,1,1,1,1,1.1,1.1,1.5,1.5,109,110,1,1,1,1,1.1,1.1,1.5,1.5,1,1,1,1,1,1,1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.5,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,1.5,1.5,1.1,1.1,111,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.5,6,1,1,1,1.5,1.5,112,113,99,99,99,99,3,3,3,2,9,9,9,9,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,2,2,99,99,99,99,99,99,99,99,99,99,99,99,99],

  [0,-6,-5,-4,-5,-4,-3,-1,0,1,3,4,5,4,5,6],[1,0,0,0,-3,-3,-3,-4,-4,-4,-3,-3,-3,0,0,0],[4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [0,-5,-5,-5,-3,-1,0,1,3,5,5,5,3,1,0,-1,-3,-1,0,1,1,1,0,-1,-1],[1,0,1,2,4,6,6,6,4,2,1,0,-2,-4,-4,-4,-2,2,2,2,1,0,0,0,1],[2,1.1,1.1,1,1,1,1,1,1,1,1.1,1.1,1,1,1,1,1,1,1,1,1.1,1.1,1.1,1.1,1.1]
];
/*
  "-" player says 'next'
  "-t" token num 'next' is given
  "-!t" token num 'next' is removed
  "-!b" block['next'] is removed
  "-c" coins 'next' is given
  "-v" variable 'next' += 1

  enemygreen 0,230,119
*/
let smtext = [
  ["Get me bug spray!","Quick!"],
  ["Hi","I need some help",'-',"Uhh...","Usually,","When I randomly find strange people,","They will do whatever I say","-","...","HAHAHAHAHAHA","I can't belive you fell for that","Wait,","Do you remember me?","-","No?","Ok...","*sob*","Talk to the Mage."],
  ["Mastaa is at the top of the tower","-","Master?","Mastaa.","At the top of the tower."],
  ["...","-","Hello?","...","Do you have any idea","How dangerous speaking is?","-","What!?","Yes...","Ever since the corruption...","Our world is different","Guess the worst part.","-","*Silence*","I can't buy any more pizza!","*Sob*","-t","1"],
  ["Did I hear pizza?"],
  ["Hi","I like WAALLZ!","-","Ok buddy.","You should try climbing","I climbed the great wall once","If only I was allowed outside...","*Sob*","-t",5],
  ["YUU!","SHAALL!","NOTT!","PAASS!","DOO!","NOTT!","MAKKE!","MEE!","SAYY!","ITT!","AGAINN!","*GASP*"],
  ["ssap ton llahs uoY|You shall not pass","-","What?","dias I|I said","kaeps rorrim I|I mirror speak"],
  ["Heheheeeeeeeee","-","Are you the master?","Yeeeeeeees?","I aeeem Mastaaaaa","Aaaaand youuuuuuu","Areeee a POWERR","leeeeeeesssss","childeeeeeeeeee","But,","Signuptodaytogetafreeweek","ofclassesatmagetower","areyuointrestedinthis","speciallimitedoffer?","-","Not really?","Heheheeeeee","Alsooooooooo","-","Yes?","Theeeeeee Masteeeeeeeeeee","eeeeeeeeeeee","eeeeeeeeee","eeeeeee","eeee","r","Ieees","Aeeeet","Zeeee","Bottommeeeeeeeeeeee","Heheheheeeeeee","-","So I already saw the Master?","Yeeeeeeeeeeeeessss","My smoll childeeeeeeeeee","-t",2],
  ["Did my brother send you??","Go away"],
  ["Watch this!!","This is true POWERR!!","-!b",347,"Now you can't cross...","Wasn't that nice!!"],
  ["I SEEEEEE","THE GREAT WALLZZ","IN YOUR FUTURE","YOU ARE THE ONE","TO CLIMB","THE WALLZZ,","AND STOP","THE CORRUPTER.","YOU MAY HAVE ALREADY","MET PEOPLE WHO HAVE BEEN","CORRUPTED","BUT YOU WILL FACE","MANY MORE","MY SEE NO MORE"],
  ["I am warning you...","Many people here are crazy","Like completely crazy...","-t",12],
  ["JUMP ON THE STAR ONCE YOU","HAVE ALL OF THE COINS!!","YOU SHALL BE A HERO","TO US ALL..."]
];
let smToken = [];
for (let i=0; i<=smtext.length; i++){
  smToken.push(0);
}
let smtext2 = [
  ["Ahh yes","Thank you very much","And I have a question for you","Does my hat look like an orange?","-","*Silence*","Is there something wrong with","Asking about orange hats?","-","そうですよ！","Heh?"],
  ["Hi","-","Do you have any pizza by chance?","-t",3,"Why yes I do!","-t",4,"Are you one of those...","Pizza addicts?","Well,","I was once a pizza delivery man...","5 coins for a pizza?","-","Umm.","-c",-5,"Here you go!"],
  ["Hello again?","-","You lied to me.","-","You are the master","-","The master is not at the the top","No.","I am the master","Of the mages...","The granny at the top","Is named Mastaa","-","Oh.","But you made it to the top?","-","Yes","Well... You are the first","-","Really?","Yes.","Therefore","You must be the one to","Save us all","A magical gem awaits","It will give you the gift of speed","-","Where is it?","At the top.","-","*Grumble*","-t",8],
  ["Wow!", "You are really helpful!","-","What happened to","The no talking thing?","Oh,","People started getting controlled...","So it is better not to talk","How much was the pizza?","-","It was 5 coins","Oh great...","By the way,","That is","The most expensive","Pizza you could have possibly purchased","Normally 5 coins,","Last people a lifetime","Well","Here are 5 coins","*Sigh*","-c",5],
  ["Pizza for me too??","Wow","Thanks a lot","Also,","Can you send","A message to my sister?","Tell her that,","I got pizza","And she didn't...","-","Umm ok?","Once you have delivered it,","She should pay you a coin","Have fun!","-t",9],
  ["Why are you here?","-","What did you say","-","About the great wall?","I said I like WAALLZ","-","Yes, and then you mentioned","-","The great wall","Oh, yeas...","Behind lies the corrupter","It is he who you must defeat","-","Heh?","I said I like WAALLZ","-!t",5],
  ["HERREE.","HAVVEE SOMMEE COINNSS.","THEEYY WIILL HELLPP YUU!","-c",5],
  ["tfig ruoy si ereH|Here is your gift","!yarps guB|Bug spray!","-","Thanks.","-","I mean...","-","sknahT|Thanks","-t",0],
  ["Heheheheheheeeeeee","-","Umm...","-","Where is the gem?","Oheeeeeeee.","Oooooooopsieeeeeeee","Ieeeee justeeeeeeeeee...","eeeeeeeeeee","eeeeeeee","eeeeee","eeee","ee","Ayeeeeeteeee","It","-","Umm,","-","WHAT!?!","-","YOU ATE IT!?!","Yeas","-","How is that even possible??","I have good metabolism","Alsooooooooo","Justeeee useeeeee theeeeeee","eeeeeee","eeeeee","-","Could you please just state your point?","Weeeeeeeelllll,","Ieeeeee","eeeee","eee","ee","wasee sayingeeeeeeee","eeeee","-","*Frustrated noises*","eee","ee","Myeee guardeeess","Wieeelleeeeee giveeeeee","Youeeeee someeeee toolseeeee","-","What about the gap?","useeee theee","eee","eeeeeeeeeeeeee","-t",7,"WALLZZ!!","-t",6],
  ["Did my brother send you??","Go away","-","Your brother said...","I said,","GO AWAY!!","-","He got pizza...","What???","Well,","He can go die in a shoe!","-","He said you would pay me...","Are you stupid?","I'm not paying you anything","Btw","Ahead lies great danger","Ahead lies the great wall","WAALLZ!","And also","I changed my mind","Here is a coin","-c",1,"-","Uhhh... thanks?"],
  ["NOW WE ALL DIE","YOU CREATED","A HOLE IN THE","SPACE CONTINUUM","PEOPLE WITH POWER","ARE DANGEROUS","THE CORRUPTED WILL,","ALWAYS WIN","-v",0],
  ["YOU ARE HACKING :D"],
  ["Hmm?","Oh, I forgot to tell you","The poeple with the blue hats","Are the 'mages'","They used to protect everyone,","Using their magic","The only other people that have magic,","Are the 'seers'","Like me!","There are also just random people too...","As one last piece of advice,","You don't ever have to listen to seers","We often lie","-t",13],
  ["DON'T JUMP ON THE GOAL BLOCK!!","IT WILL KILL US ALL"]
];
let entityTextureMapX = [1,2,3,3,3,3,3,3,3,6,5,4,4,4,4,4,0,0,0,0,0,0,0,0];
let str = [0];
let dialougei = 0;
let dialougej = 0;
let dialouget = 0;
function dialouge(num){
  dialougei = num-100;
  if (smToken[dialougei]==0){
    dialouget = 1;
  }
  else if (smToken[dialougei]==1){
    dialouget = 2;
  }
  dialougej = 0;
  velocity2 = 0;
  velocity = 0;
}

  grassBlock = new Image();
  grassBlock.src = "assets/blocks/Grass_Block1.png";
  dirtBlock = new Image();
  dirtBlock.src = "assets/blocks/Dirt_Block1.png";
  dirtBottom = new Image();
  dirtBottom.src = "assets/blocks/Dirt_Block2.png";
  player1 = new Image();
  player1.src = "assets/skins/Player1.png";
  player2 = new Image();
  player2.src = "assets/skins/Player2.png";
  goalBlock = new Image();
  goalBlock.src = "assets/blocks/Goal1.png";
  goalBlock2 = new Image();
  goalBlock2.src = "assets/blocks/Goal2.png";
  upBlock = new Image();
  upBlock.src = "assets/blocks/Up1.png"
  downBlock = new Image();
  downBlock.src = "assets/blocks/Down1.png"
  stoneBlock = new Image();
  stoneBlock.src = "assets/blocks/Stone1.png";
  stoneBottom = new Image();
  stoneBottom.src = "assets/blocks/Stone2.png";
  spikes = new Image();
  spikes.src = "assets/blocks/Spikes1.png";
  spikes2 = new Image();
  spikes2.src = "assets/blocks/Spikes2.png";
  spikes3 = new Image();
  spikes3.src = "assets/blocks/Spikes3.png";
  spikes4 = new Image();
  spikes4.src = "assets/blocks/Spikes4.png";
  coin = new Image();
  coin.src = "assets/blocks/Coin1.png";
  topaz = new Image();
  topaz.src = "assets/blocks/Topaz1.png"
  emerald = new Image();
  emerald.src = "assets/blocks/Emerald1.png"
  ruby = new Image();
  ruby.src = "assets/blocks/Ruby1.png"
  bubble = new Image();
  bubble.src = "assets/blocks/Bubble1.png"
  devBlock = new Image()
  devBlock.src = "assets/blocks/DevBlock1.png"
  newLevelIcon = new Image()
  newLevelIcon.src = "assets/home/newLevelIcon.png"
  locked = new Image();
  locked.src = "assets/home/locked.png"
  titleImage = new Image();
  titleImage.src = "assets/home/Fidget-title.png"
  enemy1 = new Image();
  enemy1.src = "assets/entity/Enemy1.png"
  enemy1Spike1 = new Image();
  enemy1Spike1.src = "assets/entity/Enemy1Spike1.png"
  enemy1Spike2 = new Image();
  enemy1Spike2.src = "assets/entity/Enemy1Spike2.png"
  enemy1Spike3 = new Image();
  enemy1Spike3.src = "assets/entity/Enemy1Spike3.png"
  enemy1Spike4 = new Image();
  enemy1Spike4.src = "assets/entity/Enemy1Spike4.png"
  boss1Spike3 = new Image();
  boss1Spike3.src = "assets/entity/Boss1Spike3.png"
  boss1 = new Image();
  boss1.src = "assets/entity/Boss1.png"
  enemy2 = new Image();
  enemy2.src = "assets/entity/Enemy2.png"
  clockIcon = new Image();
  clockIcon.src = "assets/other/timeIcon.png"
  eye1 = new Image();
  eye1.src = "assets/skins/Eyes_1.png"
  eye2 = new Image();
  eye2.src = "assets/skins/Eyes_2.png"
  entityTextureMap = new Image();
  entityTextureMap.src = "assets/entity/TextureMap.png"

  del = new Image();
  del.src = "assets/home/experimental.png"

  let bX = 0;
  let bY = 0;

  // if (gC("name") == 10) {
  //   document.getElementById("screen").remove();
  // }
  
  
  // Load networking
  
  const network = {
    config: [true, null, 25583],
    enabled: false
  }
  
  //sC("nathaniel")
  
  function sC(cname) {
    document.cookie = cname+"=true; expires=Sun, 01 Jan 2023 12:00:00 UTC";
  }
  
  function gC(cname) {
    let name = cname + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for(let i = 0; i <ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }
  let tab = "fight";
  let click = false;
  window.innerHeight-=5;
  let canvas = document.getElementById('canvas');
  let zx = window.innerWidth/200;
  let zy = window.innerHeight/100;
  let ctx = canvas.getContext('2d');
  //buildMenu
  let buttonDiv = document.getElementById('buttons');
  buttonDiv.style.display = 'none';
  let homePage = document.getElementById('homePage');
  homePage.style.display = 'none';
  let timescreen = document.getElementById('timescreen');
  timescreen.style.display = 'none';
  let editcreen = document.getElementById('editscreen');
  editscreen.style.display = 'none';
  let optionsscreen = document.getElementById('optionsscreen');
  optionsscreen.style.display = 'none';
  
  //screen is 9 tall and 19 wide
  
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  let attack = 0;
  let attackType = 2;
  //platforms
  let cT;
  let cX;
  let cY;
  let pX = [];
  let pY = [];
  let pT = [];
  let tc = 0;
  let gameState = false;
  let lx = 0-window.innerWidth/2;
  let py = 0+window.innerHeight/2;
  let ly = -py;
  let px = -lx;
  let fall = true;
  let falling = true;
  let onblock = 0;
  let onleft = 0;
  let onright = 0;
  let oni = 0;
  let jump = 7.2;
  let gravity = 0.2;
  let terminalVelocity = -5;
  let run = 2;
  let coins = 0;
  let height = 0;
  let type = 1;  
  let c = 9 || 9;
  let e = 10 || 10;
  let r = 11 || 11;
  let t = 12 || 12;  
  let menu = false 
  let data;
  let inside = false;
  let dying = false;
  let entity = [];
  console.log('type,x,y,timer,i1,i2')
  let particle = [[1,0,0]];
  let newLevelX = [[0]];
  let newLevelY = [[0]];
  let newLevelT = [[0]];
  let newLevelTc = [0];
  let newLevelS = 0;
  let newLock = [2];
  let levelType = 1;
  let level = 1;
  let velocity = 0;
  let velocity2 = 0;
  let look = 'right';
  let buildable = true;
  let dx;
  let dy;
  let dt;
  //music
  let mfos = document.getElementById('mfos');
  let mtl = document.getElementById('mtl');
  function isPlaying(tracknum) { return !tracknum.paused; };
  let smTc = [10,1];
  let smS = 0;
  let smLock = [1,1];
  let smX = [];
  let smY = [];
  let smT = [];
  let temp;
  for (let i = 1; i<3; i++){
    smX.push(jsm[i*3-3]);
    smY.push(jsm[i*3-2]);
    smT.push(jsm[i*3-1]);
  }
  let menuScroll = 0;
  let dev = false;
  let effect = 0;
  let tv = 0;
  let genLevelTc = [2,2,3,6,4,1,6,1,6,9,1,20,40,1,18,10,5,6,5,5,4,1,1,37,1];
  let genLevelS = 0;
  let genLock = [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2];
  let genLevelX = [];
  let genLevelY = [];
  let genLevelT = [];
  let timer = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
  let bestTime = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
  let genLevelStat = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
  let smLevelStat = [0];
if (localStorage.getItem('genLock') == null) {
  genLock = [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
  bestTime = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
  genLevelStat = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
}
else {
  genLock = JSON.parse(localStorage.getItem('genLock'));
  timer = JSON.parse(localStorage.getItem('bestTime'));
  bestTime = JSON.parse(localStorage.getItem('bestTime'));
  genLevelStat = JSON.parse(localStorage.getItem('genLevelStat'));
}
if (genLock.length <= 25){
  genLock.push(2)
  timer.push(0)
  bestTime.push(0)
  genLevelStat.push(1)
}
genLock[24]=2;

  //update
  let updateInterval

  for (let i = 1; i<genLevelTc.length+1; i++){
    genLevelX.push(jp[i*3-3]);
    genLevelY.push(jp[i*3-2]);
    genLevelT.push(jp[i*3-1]);
  }
  updateInterval = setInterval(update, 12.5);
  
  //skins
  let skinc;
  let skint;

  skin = new Image();
  skin.src = "assets/skins/player1.png";
  skinc = gC("sanjith");
  if (skinc == "true"){
    skint = true;
    skin.src = "assets/skins/Pratskin.png"
  }
  skinc = gC("pratulya");
  if (skinc == "true"){
    skint = true;
    skin.src = "assets/skins/Pratskin.png"
  }
  skinc = gC("krishna");
  if (skinc == "true"){
    skint = true;
    skin.src = "assets/skins/player1.png"
  }
  skinc= gC("nathaniel");
  if (skinc == "true"){
    skint = true;
    skin.src = "assets/skins/Armorskin.png"
  }
  let eo1 = document.getElementById('option1');
  let eo2 = document.getElementById('option2');
  let eo3 = document.getElementById('option3');
  let o1 = eo1.checked;
  let o2 = eo2.checked;
  eo3.checked = true;
  let o3 = eo3.checked;
function updateOptions(){
  o1 = eo1.checked;
  o2 = eo2.checked;
  o3 = eo3.checked;
  if (o1 == false){
    if (window.confirm('Are you sure you want to reset all of your progress?')){
      alert("If you decline page reload, progress will still be cleared");
      alert("To save progress, simply turn the setting back on");
      clearLocalStorage();
    }
    else{
      eo1.checked = true;
    }
  }
}
//get input
let input = document.getElementById('coinInput');

//keycodes
let map = {};
onkeydown = onkeyup = function(e){
    e = e || event;
    map[e.keyCode] = e.type == 'keydown';
}


function update(){
  if (gameState == false){
    if (mfos.paused == false){
      mfos.pause();
    }
    if (mtl.paused == false){
      mtl.pause();
    }
    document.body.style.cursor = 'auto';
    const urlParams = new URLSearchParams(window.location.search);
    const page = urlParams.get('page');

    if (page == 'stats') {
      tab = "stats";
    }
    
    homePage.style.display = 'block';
    canvas.style.overflow = 'auto';
    
    if (tab == "time"){
      timescreen.style.display = 'block';
      editscreen.style.display = 'none';
      optionsscreen.style.display = 'none';
      
      //screen size
      canvas.width = window.innerWidth;
      canvas.height = 1477.5;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    
      //background
      ctx.fillStyle = '#ffffff'
      ctx.fillRect(0,0,canvas.width, canvas.height);
      ctx.fillStyle = "#696969";
      ctx.fillRect(0,0,canvas.width,10);
      ctx.fillStyle = '#cccccc'
      ctx.fillRect(40,260,canvas.width-80,160);
      
      //levels :D
      
      for (let i = 0; i < genLevelX.length; i++) {
        ctx.fillStyle = '#ffffff'
        ctx.fillRect(i*110+50+110*genLevelS,270,100,140);
        ctx.fillStyle = 'black'
        ctx.font = "20px Arial";
        ctx.fillText('Level '+(i+1),i*110+60+110*genLevelS,300);
        if (genLock[i] == 0){
          ctx.drawImage(locked,i*110+50+110*genLevelS,300);
        }
        else if (genLock[i] == 1){
          if(genLevelStat[i]>0){  
            if (timer[i]<bestTime[i]){
              bestTime[i] = timer[i]
            }
            else if (bestTime[i] == 0){
              bestTime[i] = timer[i]
            }
            ctx.font = "14px Arial";
            ctx.fillText('Time:'+secToTime(bestTime[i]),i*110+60+110*genLevelS,400);
          }
        }
        else if (genLock[i] == 2){
          ctx.drawImage(del,i*110+50+110*genLevelS,300);
          if(genLevelStat[i]>0){  
            if (timer[i]<bestTime[i]){
              bestTime[i] = timer[i]
            }
            else if (bestTime[i] == 0){
              bestTime[i] = timer[i]
            }
            ctx.font = "14px Arial";
            ctx.fillText('Time:'+secToTime(bestTime[i]),i*110+60+110*genLevelS,400);
          }
        }
      }
    
      //outer box(es)
      ctx.fillStyle = '#696969'
      ctx.fillRect(30,230,canvas.width-60,30);
      ctx.fillRect(30,420,canvas.width-60,10);
      ctx.fillRect(30,230,10,200);
      ctx.fillRect(canvas.width-40,230,10,200);
      ctx.fillRect(30,470,canvas.width-40,85+bestTime.length*30);
      ctx.fillStyle = '#cccccc';
      ctx.fillRect(40,500,canvas.width-80,45+bestTime.length*30);
      ctx.font = "20px Arial";
      ctx.fillText('Levels',40,252.5);
      ctx.fillText('Personal Records',40,492.5);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(45,505,canvas.width-90,35+bestTime.length*30);
      ctx.fillStyle = '#000000';
      ctx.fillText("Best Time",160,532.5);
      ctx.fillText("Total Attempts",310,532.5);
      for (let i = 0; i < bestTime.length; i++){
        if (genLevelStat[i] == 0){
          ctx.fillStyle = '#cccccc';
        }
        ctx.strokeStyle = "#696969";
        ctx.beginPath();
        ctx.moveTo(50,540+30*i);
        ctx.lineTo(canvas.width-50,540+30*i);
        ctx.stroke();
        ctx.fillText("level "+(i+1),60,562.5+30*i);
        ctx.fillText(secToTime(bestTime[i]),160,562.5+30*i);
        ctx.fillText(genLevelStat[i],310,562.5+30*i);
      }
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,30, canvas.height);
      ctx.fillRect(canvas.width-30,0,30, canvas.height);

      //title image
      ctx.drawImage(titleImage,(canvas.width-500)/2,10);
    }
    else if (tab == "edit"){
      timescreen.style.display = 'none';
      editscreen.style.display = 'block';
      optionsscreen.style.display = 'block';
      
      //screen size
      canvas.width = window.innerWidth;
      canvas.height = 900;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    
      //background
      ctx.fillStyle = '#ffffff'
      ctx.fillRect(0,0,canvas.width, canvas.height);
      ctx.fillStyle = "#696969";
      ctx.fillRect(0,0,canvas.width,10);
      ctx.fillStyle = '#cccccc'
      ctx.fillRect(40,260,canvas.width-80,160);
      
      //Built levels
      for (let i = 0; i < newLevelX.length; i++) {
        ctx.fillStyle = '#ffffff'
        ctx.fillRect(i*110+50+110*newLevelS,270,100,140);
        ctx.fillStyle = 'black'
        ctx.font = "20px Arial";
        if (newLock[i] == 1){
          ctx.fillText('Level '+(i),i*110+60+110*newLevelS,300);
        }
        else if (newLock[i] == 0){
          ctx.fillText('Level '+(i),i*110+60+110*newLevelS,300);
          ctx.drawImage(locked,i*110+50+110*newLevelS,300);
        }
        else if (newLock[i] == 2){
          ctx.font = "17px arial";
          ctx.drawImage(newLevelIcon,i*110+50+110*newLevelS,270)
        }
      }
    
      //outer box(es)
      ctx.fillStyle = '#696969'
      ctx.fillRect(30,230,canvas.width-60,30);
      ctx.fillRect(30,420,canvas.width-60,10);
      ctx.fillRect(30,230,10,200);

      ctx.fillRect(20,470,canvas.width-40,242);
      ctx.fillRect(0,470,canvas.width,10);
      ctx.fillRect(canvas.width-40,60,10,200);
      ctx.fillStyle = '#cccccc';

      ctx.fillRect(40,500,canvas.width-80,202);
      ctx.font = "20px Arial";
      ctx.fillText('Custom Levels',40,252.5);
      ctx.fillText('Settings',40,492.5);
      ctx.fillStyle = "#ffffff";

      ctx.fillRect(50,510,canvas.width-100,54);
      ctx.fillRect(50,574,canvas.width-100,54);
      ctx.fillRect(50,638,canvas.width-100,54);

      ctx.fillRect(0,0,30, canvas.height);
      ctx.fillRect(canvas.width-30,0,30, canvas.height);
    
      //title image
      ctx.drawImage(titleImage,(canvas.width-500)/2,10);
    }
    else if (tab == "fight"){
      timescreen.style.display = 'none';
      editscreen.style.display = 'none';
      optionsscreen.style.display = 'none';
      
      //screen size
      canvas.width = window.innerWidth;
      canvas.height = 900;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    
      //background
      ctx.fillStyle = '#ffffff'
      ctx.fillRect(0,0,canvas.width, canvas.height);
      ctx.fillStyle = "#696969";
      ctx.fillRect(0,0,canvas.width,10);
      ctx.fillStyle = '#cccccc'
      ctx.fillRect(40,260,canvas.width-80,160);
      
      //Boss levels
      for (let i = 0; i < smX.length; i++) {
        ctx.fillStyle = '#ffffff'
        ctx.fillRect(i*110+50+110*smS,270,100,140);
        ctx.fillStyle = 'black'
        ctx.font = "20px Arial";
        ctx.fillText('Part '+(i+1),i*110+60+110*smS,300);
        if (smLock[i] == 0){
          ctx.drawImage(locked,i*110+50+110*smS,300);
        }
      }
    
      //outer box(es)
      ctx.fillStyle = '#696969'
      ctx.fillRect(30,230,canvas.width-60,30);
      ctx.fillRect(30,420,canvas.width-60,10);
      ctx.fillRect(30,230,10,200);
      ctx.fillRect(canvas.width-40,230,10,200);
      ctx.fillStyle = '#cccccc';
      ctx.font = "20px Arial";
      ctx.fillText('Boss fights',40,252.5);
      ctx.fillStyle = "#ffffff";

      ctx.fillRect(0,0,30, canvas.height);
      ctx.fillRect(canvas.width-30,0,30, canvas.height);
    
      //title image
      ctx.drawImage(titleImage,(canvas.width-500)/2,10);
    }
  }
  if (gameState != false){
    canvas.style.overflow = 'hidden';
    scrollTo(0,0);
    if(levelType == 1){
      if (mtl.paused == true && o3 == true){
        mtl.play();
      }
    }
    else if (levelType == 2.9){
      if (level == 2){
        summon(3);
        mfos.currentTime = 0;
      }
      levelType = 3;
    }
    else {
      if (mfos.paused == true && o3 == true){
        mfos.play();
      }
    }

    py = 0+window.innerHeight/2;
    //px = 0+window.innerWidth/2
    homePage.style.display = 'none';
    canvas.style.overflow = 'hidden';
    if (attack > 0){
      attack -= 1;
    }
    if(levelType == 1 && gameState == 'play'){
      document.body.style.cursor = 'none';
      timer[level-1]+=1;
    }
    
    //reset
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
    //background
    //ctx.fillStyle = '#94faff'
    //ctx.fillRect(0,0,canvas.width, canvas.height,);
    
    //falling
      if (fall == true){
        if (velocity > terminalVelocity){
        velocity -= gravity
        }
        falling = true;
      }
      else {
        falling = false;
        velocity = 0;
      }
      if (dialouget == 0){
        keyUpdate();
      }
      fall = true;
      ly -= velocity;
  
    //player and entity display
      kineticDisplay(1,-1);
    
    //draw tiles
      drawUpdate(1);
    
      inside = false;
      for (let i = 0; i < pX.length; i++){
  
      //hitboxes
        //wall hitboxes
        if (pT[i] == 99 && pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -50 && (-50)*pY[i]+85*zy-ly-py > -50 && (-50)*pY[i]+85*zy-ly-py < 20){
          inside = true;
        }
        //small hitbox
        else if (pT[i] >= 100){
          if (pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -25 && (-50)*pY[i]+85*zy-ly-py > 10 && (-50)*pY[i]+85*zy-ly-py < 20){
            if ((-50)*pY[i]+85*zy-ly - py < 20){
              ly -= 0.1;
            }
            fall = false;
            onblock = pT[i];
            height = pY[i];
            oni = i;
            dx = pX[i];
            dy = pY[i];
          }
          else if(pX[i]*50-lx-px < -5 && pX[i]*50-lx-px > -25 && (-50)*pY[i]+85*zy-ly - py < 20 && (-50)*pY[i]+85*zy-ly - py > -25){
            lx += 2;
            onleft = pT[i];
            velocity2 = 2;
            dialouge(pT[i]);
          }
          else if(pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > 0 && (-50)*pY[i]+85*zy-ly - py < 20 && (-50)*pY[i]+85*zy-ly - py > -25){
            lx += -2;
            onleft = pT[i];
            velocity2 = -2;
            dialouge(pT[i]);
          }
          else if(pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -25 && (-50)*pY[i]+85*zy-ly - py < -15 && (-50)*pY[i]+85*zy-ly - py > -25 && pT[i] != 9 && pT[i] != 20 && pT[i] != 21 && pT[i] != 8 && pT[i] != 3.2 && pT[i] != 3.3 && pT[i] != 3.4){
            velocity = -0.1
          }
        }
        
        //spike top, right, and left
        else if (pT[i] == 3){
          if (pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -50 && (-50)*pY[i]+85*zy-ly - py < -10 && (-50)*pY[i]+85*zy-ly - py > -45){
            death();
          }
        }
        else if (pT[i] == 3.2){
          if (pX[i]*50-lx-px < 15 && pX[i]*50-lx-px > -20 && (-50)*pY[i]+85*zy-ly - py < 20 && (-50)*pY[i]+85*zy-ly - py > -50){
            death();
          }
        }
        else if (pT[i] == 3.4){
          if (pX[i]*50-lx-px < -10 && pX[i]*50-lx-px > -45 && (-50)*pY[i]+85*zy-ly - py < 20 && (-50)*pY[i]+85*zy-ly - py > -50){
            death();
          }
        }
        //coin top
        else if (pT[i] == 9){
          if (pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -25 && (-50)*pY[i]+85*zy-ly-py > -25 && (-50)*pY[i]+85*zy-ly-py < 0){
            collect(i);
          }
        }
        //gem top, right, left and bottom
        else if (pT[i] == 10 || pT[i] == 11 || pT[i] == 12){
          if (pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > 0 && (-50)*pY[i]+85*zy-ly-py > -50 && (-50)*pY[i]+85*zy-ly-py < 15){
            collect(i);
          }
          if (pX[i]*50-lx-px > -50 && pX[i]*50-lx-px < -30 && (-50)*pY[i]+85*zy-ly-py > -50 && (-50)*pY[i]+85*zy-ly-py < 15){
            collect(i);
          }
          if (pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -50 && (-50)*pY[i]+85*zy-ly - py < 20 && (-50)*pY[i]+85*zy-ly - py > 10){
            collect(i);
          }
          if(pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -50 && (-50)*pY[i]+85*zy-ly - py < -40 && (-50)*pY[i]+85*zy-ly - py > -50 && pT[i] != 9){
            collect(i);
          }
        }
        //down block top
        else if (pT[i] == 5 && pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -50 && (-50)*pY[i]+85*zy-ly - py < 20 && (-50)*pY[i]+85*zy-ly - py > 10){
          fall = true;
          onblock = pT[i];
          height = pY[i];
          oni = i;
          dx = pX[i];
          dy = pY[i];
        }
        //main top
        else if (pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -50 && (-50)*pY[i]+85*zy-ly - py < 20 && (-50)*pY[i]+85*zy-ly - py > 10 && pT[i] !=3 && pT[i] !=3.2 && pT[i] !=3.4 && pT[i] != 20 && pT[i] != 21 && pT[i] != 99){
          if (pT[i] == 8 && dev == true){
            if ((-50)*pY[i]+85*zy-ly - py < 20){
              ly -= 0.1;
            }
            fall = false;
            onblock = pT[i];
            height = pY[i];
            oni = i;
            dx = pX[i];
            dy = pY[i];
          }
          else if (pT[i] != 8){
            if ((-50)*pY[i]+85*zy-ly - py < 20){
              ly -= 0.1;
            }
            fall = false;
            onblock = pT[i];
            height = pY[i];
            oni = i;
            dx = pX[i];
            dy = pY[i];
          }
        }
        else if (pT[i] == 3.3){
          if (pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -50 && (-50)*pY[i]+85*zy-ly - py < 15 && (-50)*pY[i]+85*zy-ly - py > -20){
            death();
          }
        }
  
        //bottom
        if(pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > -50 && (-50)*pY[i]+85*zy-ly - py < -40 && (-50)*pY[i]+85*zy-ly - py > -50 && pT[i] != 9 && pT[i] != 20 && pT[i] != 21 && pT[i] != 8 && pT[i] != 3.2 && pT[i] != 3.3 && pT[i] != 3.4 && pT[i]<99){
          if (pT[i] == 5){
            velocity = -5;
          }
          else {
          velocity = -0.1
          }
        }
        //left side
        else if (pX[i]*50-lx-px > -50 && pX[i]*50-lx-px < -30 && (-50)*pY[i]+85*zy-ly-py > -50 && (-50)*pY[i]+85*zy-ly-py < 15 && pT[i] != 9 && pT[i] != 20 && pT[i] != 21 && pT[i]!=3 && pT[i]!=3.3 && pT[i]!=3.2 && pT[i] != 8 && pT[i]<99){
          lx += 2;
          onleft = pT[i];
          velocity2 = 2;
          if (map[87] || map[38]){
            velocity = jump;
          }
        }
  
        //right side
        else if (pX[i]*50-lx-px < 20 && pX[i]*50-lx-px > 0 && (-50)*pY[i]+85*zy-ly-py > -50 && (-50)*pY[i]+85*zy-ly-py < 15 && pT[i] != 9 && pT[i] != 20 && pT[i] != 21 && pT[i]!=3 && pT[i]!=3.4 && pT[i]!=3.3 && pT[i] != 8 && pT[i]<99){
          lx -= 2;
          onright = pT[i];
          velocity2 = -2;
          if (map[87] || map[38]){
            velocity = jump;
          }
        }
    }
  
    //respawn
      if (ly > 1150){
        lx = 0-window.innerWidth/2;
        ly = 0-window.innerHeight/2;
        py = -ly;
        px = -lx;
        fall = true;
        velocity = -1;
        levelSet();
      }
  
    //next level
      if (onblock == 6 && coins >= tc){
        win();
      }
      /*if (onblock == 3){
        death();
      }*/
      if (onblock == 10 || onblock == 11 || onblock == 12){
        collect(oni);
      }
      if (onblock == 4){
        fall = true;
        velocity = 12;
      }
      if (onblock == 5){
        fall = true;
        velocity = -10;
      }
      if (onblock == 7){
        collect(oni);
      }
    onblock = 0;
  
    if (menu == true){
      ctx.fillStyle = '#696969'
      ctx.fillRect(100,0,canvas.width-200,64);
      ctx.fillStyle = '#cccccc';
      ctx.fillRect(122,2,canvas.width-244,60);
      for (let i = 1; i < 22; i++){
        if(i == 1){
          tv = grassBlock
        }
        else if(i == 2){
          tv = dirtBlock
        }
        else if(i == 3){
          tv = dirtBottom
        }
        else if(i == 4){
          tv = stoneBlock
        }
        else if(i == 5){
          tv = spikes
        }
        else if(i == 6){
          tv = spikes2
        }
        else if(i == 7){
          tv = spikes3
        }
        else if(i == 8){
          tv = spikes4
        }
        else if(i == 9){
          tv = upBlock
        }
        else if(i == 10){
          tv = downBlock
        }
        else if(i == 11){
          tv = goalBlock
        }
        else if(i == 12){
          tv = bubble
        }
        else if(i == 13){
          tv = devBlock
        }
        else if(i == 14){
          tv = coin
        }
        else if(i == 15){
          tv = emerald
        }
        else if(i == 16){
          tv = ruby
        }
        else if(i == 17){
          tv = topaz
        }
        else if(i == 18){
          tv = 0
        }
        else if(i == 19){
          tv = enemy1;
        }
        else if(i == 20){
          tv = enemy2;
        }
        else if(i == 21){
          tv = stoneBlock;
        }
        else {
          tv = grassBlock
        }
        if (72+55*i+55*menuScroll < canvas.width-172 && 72+55*i+55*menuScroll > 86) {
          if (tv == 0){
            ctx.fillStyle = '#ffffff'
            ctx.fillRect(72+55*i+55*menuScroll,7,50,50);
            ctx.strokeStyle = '#000000'
            ctx.strokeRect(72+55*i+55*menuScroll,7,50,50);
            ctx.fillStyle = '#000000'
            ctx.font = '16px Arial'
            ctx.fillText('Editor',74+55*i+55*menuScroll,28);
            ctx.fillText(dev,83+55*i+55*menuScroll,44);
            ctx.font = '20px Arial'
          }
          else if (tv == spikes || tv == spikes3){
            ctx.drawImage(tv,72+55*i+55*menuScroll,22);
          }
          else if (tv == spikes2 || tv == spikes4){
            ctx.drawImage(tv,87+55*i+55*menuScroll,7);
          }
          else if (tv == coin || tv == enemy1 || tv == enemy2){
            ctx.drawImage(tv,89.5+55*i+55*menuScroll,24.5);
          }
          else if (tv == emerald || tv == ruby || tv == topaz){
            ctx.drawImage(tv,82+55*i+55*menuScroll,17);
          }
          else {
            ctx.drawImage(tv,72+55*i+55*menuScroll,7);
          }
        }
      }
    }
        if (entity.length > 0){
          for (let k = 1; k<9; k++){
            /*if (k == 1){
              data = ctx.getImageData(px, py, 1, 1).data; 
            }
            if (k == 2){
              data = ctx.getImageData(px+10, py, 1, 1).data; 
            }
            if (k == 3){
              data = ctx.getImageData(px+19, py, 1, 1).data;
            }
            if (k == 4){
              data = ctx.getImageData(px+19, py+8, 1, 1).data; 
            }
            if (k == 5){
              data = ctx.getImageData(px+19, py+19, 1, 1).data; 
            }
            if (k == 6){
              data = ctx.getImageData(px+10, py+19, 1, 1).data; 
            }
            if (k == 7){
              data = ctx.getImageData(px, py+19, 1, 1).data; 
            }
            if (k == 8){
              data = ctx.getImageData(px, py+8, 1, 1).data; 
            }
            if (data[0] == 0 && data[1] == 200 && data[2] == 83){
              death();
            }
            else if (data[0] == 211 && data[1] == 47 && data[2] == 47){
              death();
            }
            else if (data[0] == 239 && data[1] == 154 && data[2] == 154){
              death();
            }
            else if (data[0] == 239 && data[1] == 82 && data[2] == 80){
              death();
            }*/
          }
        }
    }
  }

function win(){
    if (levelType == 3 && level == 1){
      particlize(3);
      //fix later
      ly -= 10000000;
    }
    else{
      level+=1;
      lx = 0-window.innerWidth/2;
      ly = 0-window.innerHeight/2;
      py = -ly;
      px = -lx;
      fall = true;
      falling = true;
      onblock = 0;
      gameState = 'win';
      dev = false;
      buttonDiv.style.display = 'none';
      if (levelType == 1){
        if (genLock[level-1] == 0){
          genLock[level-1] = 1;
        }
      }
      if (o1 == true){
        updateLocalStorage();
      }
      levelSet();
    }
  }

  function death(){
    if(dying==false){
      particlize(2);
      //dow = -1;
    }
    dying = true;
  }
  
  function particlize(num){
    if (num == 1){
      particle.push([1,0,0])
    }
    if (num == 2){
      for (let i = 0; i < 50; i++) {
        particle.push([2,0,getRandomInt(360),px+10,py+10]);
      }
      particle.push([2.1,0])
    }
    if (num == 3){
      particle.push([3,100,0,230,119])
    }
    if (num == 10){
      particle.push([10,0])
    }
  }
  
  function kineticDisplay(num, j) {
  
    if (dying == false){
      //draw player
      if (j>-1){
        if (skint == true){
            ctx.drawImage(skin,px,py);
        }
        else {
          //ctx.drawImage(player1,px,py);
          if (look == 'right'){
            ctx.drawImage(player1,px,py);
          }
          else if (look == 'left'){
            ctx.drawImage(player2,px,py);
          }
        }
        /*if (look == 'right'){
          ctx.drawImage(eye1,px+5,py+6);
        }
        else if (look == 'left'){
          ctx.drawImage(eye2,px+5,py+6);
        } */
        ctx.globalAlpha=(particle[j][1]%6/6);
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(px,py,20,20);
        ctx.globalAlpha=1;
      }
      
      else if (num == 1 || entity.length > 0){
        ctx.strokeRect(px+1,py+1,18,18)
        if (effect == 1){
          ctx.strokeStyle = '#00e677';
          ctx.strokeRect(px-1,py-1,22,22);
        }
        else if (effect == 2){
          ctx.strokeStyle = '#d81b60';
          ctx.strokeRect(px-1,py-1,22,22);
        }
        else if (effect == 3){
          ctx.strokeStyle = '#ffc928';
          ctx.strokeRect(px-1,py-1,22,22);
        }
        if (skint == true){
            ctx.drawImage(skin,px,py);
        }
        else {
          //ctx.drawImage(player1,px,py);
          if (look == 'right'){
            ctx.drawImage(player1,px,py);
          }
          else if (look == 'left'){
            ctx.drawImage(player2,px,py);
          }
        }
        /*if (look == 'right'){
          ctx.drawImage(eye1,px+5,py+6);
        }
        else if (look == 'left'){
          ctx.drawImage(eye2,px+5,py+6);
        } */
      }
    }
    //entity display
    for(let i=0; i < entity.length; i++){
      if (entity[i][0] == -1){
        entity[i][2] += 5;
        ctx.fillStyle = "rgb(255,0,0)"
        ctx.fillRect(entity[i][1]-lx,entity[i][2]-ly,25,25);
      }
      else if (entity[i][0] == -2){
        entity[i][3] += 1;
        ctx.fillStyle = "rgb(255,0,0)"
        if (entity[i][3] <= 50){
          ctx.beginPath();
          ctx.arc(entity[i][1]-lx,entity[i][2]-ly,entity[i][3],0,Math.PI*2);
          ctx.fill();
        }
        else if (entity[i][3] <= 100){
          ctx.beginPath();
          ctx.arc(entity[i][1]-lx,entity[i][2]-ly,100-entity[i][3],0,Math.PI*2);
          ctx.fill();
        }
      }
      else if (entity[i][0] == 1){
        entity[i][3] += 1;
        let x = entity[i][1];
        let y = entity[i][2];
        if (entity[i][3] > 200){
          entity[i][3]=0;
        }
        if (entity[i][3] <=25){
          ctx.drawImage(enemy1Spike1,x-lx+25,y-ly+25-entity[i][3]);
          ctx.drawImage(enemy1Spike2,x-lx+25+entity[i][3],y-ly+25);
          ctx.drawImage(enemy1Spike3,x-lx+25,y-ly+25+entity[i][3]);
          ctx.drawImage(enemy1Spike4,x-lx+25-entity[i][3],y-ly+25);
        }
        else if (entity[i][3] <=75){
          ctx.drawImage(enemy1Spike1,x-lx+25,y-ly);
          ctx.drawImage(enemy1Spike2,x-lx+50,y-ly+25);
          ctx.drawImage(enemy1Spike3,x-lx+25,y-ly+50);
          ctx.drawImage(enemy1Spike4,x-lx,y-ly+25);
        }
        else if (entity[i][3] <=100){
          ctx.drawImage(enemy1Spike1,x-lx+25,y-ly+entity[i][3]-75);
          ctx.drawImage(enemy1Spike2,x-lx-entity[i][3]+125,y-ly+25);
          ctx.drawImage(enemy1Spike3,x-lx+25,y-ly-entity[i][3]+125);
          ctx.drawImage(enemy1Spike4,x-lx+entity[i][3]-75,y-ly+25);
        }
        ctx.drawImage(enemy1,x-lx+25,y-ly+25);
        
      }
      else if (entity[i][0] == 2){
        if (entity[i][3] >=0){
          ctx.drawImage(enemy2,entity[i][1]-lx,entity[i][2]-ly+entity[i][3]);
        }
        else{
          ctx.drawImage(enemy2,entity[i][1]-lx,entity[i][2]-ly-entity[i][3]);
        }
        if (entity[i][5] == 0){
          if(lx+px+30>=entity[i][1] && lx+px<=entity[i][1]+30 && ly+py+35 >=entity[i][2]+entity[i][3]){
            entity[i][3] += 10;
          }
          else if (entity[i][3] > 0){
            entity[i][3]=entity[i][3]*-1;
            entity[i][5]=40
          }
          else if (entity[i][3] < 0){
            entity[i][3]+=10;
          }
        }
        else {
          entity[i][5]-=1;
        }
      }
      else if (entity[i][0] == 3){
        for (let k = 1; k<9; k++){
            /*if (k == 1){
              data = ctx.getImageData(pX[0]*50-lx, (-50)*pY[0]+85*zy-ly, 1, 1).data; 
            }
            if (k == 2){
              data = ctx.getImageData(pX[0]*50-lx+25, (-50)*pY[0]+85*zy-ly, 1, 1).data; 
            }
            if (k == 3){
              data = ctx.getImageData(pX[0]*50-lx+49, (-50)*pY[0]+85*zy-ly, 1, 1).data;
            }
            if (k == 4){
              data = ctx.getImageData(pX[0]*50-lx+49, (-50)*pY[0]+85*zy-ly+25, 1, 1).data; 
            }
            if (k == 5){
              data = ctx.getImageData(pX[0]*50-lx+49, (-50)*pY[0]+85*zy-ly+49, 1, 1).data; 
            }
            if (k == 6){
              data = ctx.getImageData(pX[0]*50-lx+25, (-50)*pY[0]+85*zy-ly+49, 1, 1).data; 
            }
            if (k == 7){
              data = ctx.getImageData(pX[0]*50-lx, (-50)*pY[0]+85*zy-ly+49, 1, 1).data; 
            }
            if (k == 8){
              data = ctx.getImageData(pX[0]*50-lx, (-50)*pY[0]+85*zy-ly+25, 1, 1).data; 
            }
            if (data[0] == 255 && data[1] == 0 && data[2] == 0){
              entity[i][5]-=1
              break;
            }*/
          }
          if (entity[i][5] <= 0){
            win();
          }
        entity[i][3] += 1;
        /*comment: each 1/8 note is 12 frames*/
        //attack    150 frames
        ctx.drawImage(boss1,pX[0]*50-lx,(-50)*pY[0]+85*zy-ly);
        ctx.fillStyle = "#cccccc"
        ctx.fillRect(pX[0]*50-lx,(-50)*pY[0]+85*zy-ly-10,entity[i][5]/2,10);
        if (entity[i][3]%48==0){
          entity[i][4] += 1;
          switch (entity[i][4]) {
          case 5:
            summon(3.1,1,0)
            summon(3.1,3,0)
            summon(3.1,13,0)
            summon(3.1,15,0)
            summon(3.2,2,-48)
            summon(3.2,14,-48)
            break
          case 10:
            summon(3.1,4,0)
            summon(3.1,6,0)
            summon(3.1,10,0)
            summon(3.1,12,0)
            summon(3.2,5,-48)
            summon(3.2,11,-48)
            break
          case 15:
            summon(3.1,7,0)
            summon(3.1,9,0)
            summon(3.2,8,-48)
            break
          case 22:
            summon(3.2,7,0)
            summon(3.2,9,0)
            break
          case 24:
            summon(3.2,6,0)
            summon(3.2,10,0)
            break
          case 26:
            summon(3.2,5,0)
            summon(3.2,11,0)
            break
          case 28:
            summon(3.2,4,0)
            summon(3.2,12,0)
            break
          case 30:
            summon(3.2,1,0)
            summon(3.2,15,0)
            break
          case 35:
            summon(3.2,1,-240)
            summon(3.2,6,-240)
            summon(3.2,7,-240)
            summon(3.2,8,-240)
            summon(3.2,9,-240)
            summon(3.2,10,-240)
            summon(3.2,13,-240)
            summon(3.2,14,-240)
            summon(3.2,15,-240)
            break
          case 45:
            summon(3.2,1,-240)
            summon(3.2,2,-240)
            summon(3.2,3,-240)
            summon(3.2,6,-240)
            summon(3.2,7,-240)
            summon(3.2,8,-240)
            summon(3.2,9,-240)
            summon(3.2,10,-240)
            summon(3.2,15,-240)
            break
          case 55:
            summon(3.2,1,-240)
            summon(3.2,2,-240)
            summon(3.2,3,-240)
            summon(3.2,6,-240)
            summon(3.2,10,-240)
            summon(3.2,13,-240)
            summon(3.2,14,-240)
            summon(3.2,15,-240)
            break
          case 65:
            summon(3.2,1,-240)
            summon(3.2,3,-240)
            summon(3.2,6,-240)
            summon(3.2,7,-240)
            summon(3.2,8,-240)
            summon(3.2,9,-240)
            summon(3.2,10,-240)
            summon(3.2,13,-240)
            summon(3.2,15,-240)
            break
          case 80:
            entity[i][4]=0;
            break
          }
        }
      }
      else if (entity[i][0]==3.1){
        entity[i][2]+=0.5;
        ctx.fillStyle = "#00c853";
        if(entity[i][2]<=50){
          ctx.fillRect(pX[entity[i][1]]*50-lx+25-entity[i][2]/2,(-50)*pY[entity[i][1]]+85*zy-ly+25-entity[i][2]/2,entity[i][2],entity[i][2]);
        }
        else if (entity[i][2]<=75){
          ctx.drawImage(enemy1Spike1,pX[entity[i][1]]*50-lx,(-50)*pY[entity[i][1]]+85*zy+50-ly-entity[i][2]);
          ctx.drawImage(enemy1Spike1,pX[entity[i][1]]*50-lx+25,(-50)*pY[entity[i][1]]+85*zy+50-ly-entity[i][2]);
          ctx.fillRect(pX[entity[i][1]]*50-lx,(-50)*pY[entity[i][1]]+85*zy-ly,50,50);
        }
        else if (entity[i][2]<=87.5){
          ctx.drawImage(enemy1Spike1,pX[entity[i][1]]*50-lx,(-50)*pY[entity[i][1]]+85*zy-ly-175+entity[i][2]*2);
          ctx.drawImage(enemy1Spike1,pX[entity[i][1]]*50-lx+25,(-50)*pY[entity[i][1]]+85*zy-ly-175+entity[i][2]*2);
          ctx.fillRect(pX[entity[i][1]]*50-lx,(-50)*pY[entity[i][1]]+85*zy-ly,50,50);
        }
        else {
          entity.splice(i,1);
        }
      }
      else if (entity[i][0]==3.2){
        if (entity[i][2]<0){
          entity[i][2]+=1//comment: replace with frames between attacks
          ctx.drawImage(boss1Spike3,pX[entity[i][1]]*50-lx,0);
        }
        else {
          entity[i][2]+=window.innerHeight/50;
        }
        ctx.fillStyle = "#00c853";
        if (entity[i][2]<=window.innerHeight && entity[i][2]>=0){
          ctx.fillRect(pX[entity[i][1]]*50-lx,0,50,entity[i][2]);
          ctx.drawImage(boss1Spike3,pX[entity[i][1]]*50-lx,entity[i][2]);
        }
        else if (entity[i][2]<=window.innerHeight*2){
          ctx.fillRect(pX[entity[i][1]]*50-lx,entity[i][2]-window.innerHeight,50,entity[i][2]);
        }
        else {
          entity.splice(i,1);
        }
      }
    }
  }
  
  function preDrawUpdate(){
    for (let i = 0; i < pX.length; i++){
      ctx.strokeStyle = '#000000'
      if (pT[i] == c){
        pT[i] = 9
      }
      if (pT[i] == e){
        pT[i] = 10
      }
      if (pT[i] == r){
        pT[i] = 11
      }
      if (pT[i] == 1){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,50,50);
      }
      if (pT[i] == 1.1){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,50,50);
      }
      else if (pT[i] == 2){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,50,50);
      }
      else if (pT[i] == 2.5){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,50,50);
      }
      else if (pT[i] == 3){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly+41,50,8);
      }
      else if (pT[i] == 3.2){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,8,50);
      }
      else if (pT[i] == 3.3){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,50,8);
      }
      else if (pT[i] == 3.4){
        ctx.fillRect(pX[i]*50-lx+42,(-50)*pY[i]+85*zy-ly,8,50);
      }
      else if (pT[i] == 4){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,50,50);
      }
      else if (pT[i] == 5){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,50,50);
      }
      else if (pT[i] == 6){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,50,50);
      }
      else if (pT[i] == 7){
        ctx.fillRect(pX[i]*50-lx+16,(-50)*pY[i]+85*zy-ly+16,18,18);
      }
      else if (pT[i] == 8 && dev == true){
        ctx.fillRect(pX[i]*50-lx+20,(-50)*pY[i]+85*zy-ly+20,10,10);
      }
      else if (pT[i] == 9){
        ctx.fillRect(pX[i]*50-lx+8,(-50)*pY[i]+85*zy-ly+8,7,7);
      }
      else if (pT[i] == 10){
        ctx.fillRect(pX[i]*50-lx+6,(-50)*pY[i]+85*zy-ly6,18,18);
      }
      else if (pT[i] == 11){
        ctx.fillRect(pX[i]*50-lx+20,(-50)*pY[i]+85*zy-ly+20,10,10);
      }
      else if (pT[i] == 12){
        ctx.fillRect(pX[i]*50-lx+6,(-50)*pY[i]+85*zy-ly6,18,18);
      }
      else if (pT[i] == 99 && inside == false){
        ctx.fillRect(pX[i]*50-lx+6,(-50)*pY[i]+85*zy-ly6,18,18);
      }
      if (pT[i] >= 100){
        ctx.fillRect(pX[i]*50-lx,(-50)*pY[i]+85*zy-ly,25,25);
      }
    }
  }
  
  function drawUpdate(layer){
    if (layer == 1){
      //display
      ctx.fillStyle = '#000000  ';
      ctx.drawImage(coin,10,10);
      ctx.drawImage(clockIcon,10,30);
      ctx.font = "20px Arial";
      ctx.fillText(coins + ' / ' + tc,30,22.5);
      ctx.fillText(secToTime(timer[level-1]),30,43.5);
      //coordinates
      //ctx.fillText(dx,10,40);
      //ctx.fillText(dy,50,40);
    }
    for (let i = 0; i < pX.length; i++){
      if (layer == 1){
        cT = pT[i];
        cX = pX[i];
        cY = pY[i];
      }
      if (layer == 2){
        cT = type;
        cX = bX;
        cY = bY;
      }
      if (cT == c){
        cT = 9
      }
      if (cT == e){
        cT = 10
      }
      if (cT == r){
        cT = 11
      }
      if(cT == t){
        cT = 12
      }
      if (cT == 1){
        ctx.fillRect(cX*50-lx+1,(-50)*cY+85*zy-ly+1,48,48);
        ctx.drawImage(grassBlock,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 1.1){
        ctx.fillRect(cX*50-lx+1,(-50)*cY+85*zy-ly+1,48,48);
        ctx.drawImage(dirtBlock,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 1.5){
        ctx.drawImage(dirtBottom,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 2){
        ctx.fillRect(cX*50-lx+1,(-50)*cY+85*zy-ly+1,48,48);
        ctx.drawImage(stoneBlock,cX*50-lx,(-50)*cY+85*zy-ly);
        ctx.drawImage(stoneBottom,cX*50-lx,(-50)*(cY-1)+85*zy-ly)
      }
      else if (cT == 2.5){
        ctx.drawImage(stoneBottom,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 3){
        ctx.fillRect(cX*50-lx+1,(-50)*cY+85*zy-ly+41,48,8);
        ctx.drawImage(spikes,cX*50-lx,(-50)*cY+85*zy-ly+30);
      }
      else if (cT == 3.2){
        ctx.fillRect(cX*50-lx,(-50)*cY+85*zy-ly,8,50);
        ctx.drawImage(spikes2,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 3.3){
        ctx.fillRect(cX*50-lx,(-50)*cY+85*zy-ly,50,8);
        ctx.drawImage(spikes3,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 3.4){
        ctx.fillRect(cX*50-lx+42,(-50)*cY+85*zy-ly,8,50);
        ctx.drawImage(spikes4,cX*50-lx+30,(-50)*cY+85*zy-ly);
      }
      else if (cT == 4){
        ctx.fillRect(cX*50-lx+1,(-50)*cY+85*zy-ly+1,48,48);
        ctx.drawImage(upBlock,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 5){
        ctx.fillRect(cX*50-lx+1,(-50)*cY+85*zy-ly+1,48,48);
        ctx.drawImage(downBlock,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 6){
        ctx.fillRect(cX*50-lx+1,(-50)*cY+85*zy-ly+1,48,48);
        if (coins >= tc){
          ctx.drawImage(goalBlock,cX*50-lx,(-50)*cY+85*zy-ly);
        }
        else {
          ctx.drawImage(goalBlock2,cX*50-lx,(-50)*cY+85*zy-ly);
        }
      }
      else if (cT == 7){
        ctx.fillRect(cX*50-lx+16,(-50)*cY+85*zy-ly+16,18,18);
        ctx.drawImage(bubble,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 8 && dev == true){
        ctx.fillRect(cX*50-lx+20,(-50)*cY+85*zy-ly+20,10,10);
        ctx.drawImage(devBlock,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      else if (cT == 9){
        ctx.fillRect(cX*50-lx+8,(-50)*cY+85*zy-ly+8,7,7);
        ctx.drawImage(coin,cX*50-lx+5,(-50)*cY+85*zy-ly+5);
      }
      else if (cT == 10){
        ctx.fillRect(cX*50-lx+16,(-50)*cY+85*zy-ly+16,18,18);
        ctx.drawImage(emerald,cX*50-lx+10,(-50)*cY+85*zy-ly+10);
      }
      else if (cT == 11){
        ctx.fillRect(cX*50-lx+20,(-50)*cY+85*zy-ly+20,10,10);
        ctx.drawImage(ruby,cX*50-lx+10,(-50)*cY+85*zy-ly+10);
      }
      else if (cT == 12){
        ctx.drawImage(topaz,cX*50-lx+10,(-50)*cY+85*zy-ly+10);
      }
      else if (cT == 20){
        let summony = true;
        for (let j = 0; j < entity.length; j++){
          if (entity[j][4] == i){
            summony = false
          }
        }
        if (summony == true){
          summon(1,cX-0.5,cY+0.5,i);
        }
      }
      else if (cT == 21){
        let summony = true;
        for (let j = 0; j < entity.length; j++){
          if (entity[j][4] == i){
            summony = false
          }
        }
        if (summony == true){
          summon(2,cX,cY,i);
        }
      }
      else if (cT == 99 && inside == false){
        ctx.fillRect(cX*50-lx+1,(-50)*cY+85*zy-ly+1,48,48);
        ctx.drawImage(stoneBlock,cX*50-lx,(-50)*cY+85*zy-ly);
      }
      if (cT >= 100){
        drawPlayer(cX*50-lx,(-50)*cY+85*zy-ly,cT-100);
      }
      
    }
    if (dev == true && (cX != bX || cY != bY) && layer == 1){
      buildable = true;
      ctx.strokeStyle = "#000000"
      drawUpdate(2);
      if (type == 9 || type == 20 || type == 21){
        ctx.strokeRect(bX*50-lx,(-50)*bY+85*zy-ly,25,25);
        ctx.globalAlpha=0.5;
        ctx.fillStyle = '#cccccc';
        ctx.fillRect(bX*50-lx+1,(-50)*bY+85*zy-ly+1,23,23);
        ctx.globalAlpha=1;
      }
      else{
        ctx.strokeRect(bX*50-lx,(-50)*bY+85*zy-ly,50,50);
        ctx.globalAlpha=0.5;
        ctx.fillStyle = '#cccccc';
        ctx.fillRect(bX*50-lx+1,(-50)*bY+85*zy-ly+1,48,48);
        ctx.globalAlpha=1;
      }
    }
    else {
      buildable = false;
    }
    //particles
    for (let i = 0; i < particle.length; i++){
      if (particle[i][0]==1){
        particle[i][1]+=0.5;
        
        ctx.translate(px+10,py+10);
        if (particle[i][2]==0){
          ctx.rotate(particle[i][1]*Math.PI/90);
        }
        else{
          ctx.rotate((60-particle[i][1])*Math.PI/90);
        }
        
        ctx.translate(-px-10,-py-10);
  
        ctx.beginPath();
        ctx.arc(px+10,py+10,particle[i][1],0,Math.PI*2);
        ctx.fillStyle = '#ffd968';
        ctx.fill();
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(px+10-particle[i][1],py+10-particle[i][1]/3,particle[i][1]*2,particle[i][1]*2/3);
        ctx.fillRect(px+10-particle[i][1]/3,py+10-particle[i][1],particle[i][1]*2/3,particle[i][1]*2);
        ctx.beginPath();
        if (particle[i][1]>10){
          ctx.arc(px+10,py+10,particle[i][1]-10,0,Math.PI*2);
        }
        ctx.fillStyle = '#ffd968';
        ctx.fill();
  
        ctx.translate(px+10,py+10);
        if (particle[i][2]==0){
          ctx.rotate(-particle[i][1]*Math.PI/90);
        }
        else{
          ctx.rotate(-1*(60-particle[i][1])*Math.PI/90);
        }
        ctx.translate(-px-10,-py-10);
  
        if (particle[i][1]>=30 && particle[i][2]==0){
          particle[i][2]=1;
        }
        if (particle[i][2]==1){
          kineticDisplay(1,-1);
          particle[i][1]-=1;
          if (particle[i][1]<=0.5){
            particle.splice(i,1);
          }
        }
        else {
          kineticDisplay(1,i);
        }
        
      }
      else if (particle[i][0]==2){
        
        particle[i][1]+=1;
        particle[i][3] += Math.cos(particle[i][2] * Math.PI / 180) * 4;
        particle[i][4] += Math.sin(particle[i][2] * Math.PI / 180) * 4;
        ctx.beginPath();
        ctx.arc(particle[i][3],particle[i][4],2,0,Math.PI*2);
        let colorz = 1-particle[i][1]/30
        ctx.fillStyle='rgb(255, 0, 0,' + colorz + ')';
        ctx.fill();
        if (particle[i][1]>=30){
          particle.splice(i,1);
        }
      }
      else if (particle[i][0]==2.1){
        particle[i][1]+=1;
        if (particle[i][1]>=50){
          particle.splice(i,1);
  
          lx = 0-window.innerWidth/2;
          ly = 0-window.innerHeight/2;
          py = -ly;
          px = -lx;
          fall = true;
          falling = true;
          onblock = 0;
          onright = 0;
          onleft = 0;
          velocity = -1;
          if (levelType == 3){
            levelType = 2.9;
          }
          levelSet();
          //particle.push([1,0,0])
          dying = false;
        }
      }
      else if (particle[i][0]==3){
        if (particle[i][1]==-2){
          level += 0.1;
          win();
          particle.splice(i,1);
        }
        else if (particle[i][1]==-1){
          if (str[0] == 1){
            str[0] = 0;
            particle[i][1]--;
          }
          ctx.fillStyle = "rgb(0,230,119)";
          ctx.fillRect(0,0,px*2,py*2);
        }
        else if (particle[i][1]==0){
          dialouget = 2;
          dialougei = 10;
          dialougej = 0;
          particle[i][1]--;
          ctx.fillStyle = "rgb(0,230,119)";
          ctx.fillRect(0,0,px*2,py*2);
        }
        else{
          particle[i][1]-=1;
          let grd = ctx.createRadialGradient(px, py, particle[i][1]*2, px, py, particle[i][1]*8+1);
          grd.addColorStop(0, "rgba(0,0,0,0)");
          grd.addColorStop(1, "rgb(0,230,119)");
          ctx.fillStyle = grd;
          ctx.fillRect(0,0,px*2,py*2);
        }
      }
      else if (particle[i][0]==10){
        particle[i][1]+=1;
        if (particle[i][1]<=40){
          click = false;
          ctx.fillStyle = "#00e677";
          ctx.fillRect(0,0,px,particle[i][1]*py/20);
          ctx.fillStyle = "#d81b60";
          ctx.fillRect(px,2*py-particle[i][1]*py/20,px,2*py);
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(px-particle[i][1]*(px-50)/40,py-particle[i][1]*(py-50)/40,particle[i][1]*(px-50)/20,particle[i][1]*(py-50)/20);
        }
        else if (particle[i][1]<=65){
          click = false;
          ctx.fillStyle = "#00e677";
          ctx.fillRect(0,0,px,2*py);
          ctx.fillStyle = "#d81b60";
          ctx.fillRect(px,0,px,2*py);
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(50,50,2*px-100,2*py-100);
          ctx.fillStyle = "#000000";
          ctx.font = (particle[i][1]-40)*2+"px Impact";
          if(gameState == 'death'){
            ctx.fillText("YOU DIED",px-90,150);
          }
          else if (gameState == 'win'){
            ctx.fillText("Level Complete",px-160,150);
          }
        }
        else if (particle[i][1]<=90){
          click = false;
          ctx.fillStyle = "#00e677";
          ctx.fillRect(0,0,px,2*py);
          ctx.fillStyle = "#d81b60";
          ctx.fillRect(px,0,px,2*py);
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(50,50,2*px-100,2*py-100);
          ctx.fillStyle = "#000000";
          ctx.font = 50+"px Impact";
          if(gameState == 'death'){
            ctx.fillText("YOU DIED",px-90,150);
          }
          else if (gameState == 'win'){
            ctx.fillText("Level Complete",px-160,150);
          }
          ctx.font = "30px audiowide";
          ctx.fillText("Best Time: "+secToTime(bestTime[level-2]),(particle[i][1]-65)*px/25-150,200);
          ctx.fillText("Time: "+secToTime(timer[level-2]),(particle[i][1]-90)*px/25-115,250);
        }
        else if (particle[i][1]<=115){
          click = false;
          ctx.fillStyle = "#00e677";
          ctx.fillRect(0,0,px,2*py);
          ctx.fillStyle = "#d81b60";
          ctx.fillRect(px,0,px,2*py);
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(50,50,2*px-100,2*py-100);
          ctx.fillStyle = "#000000";
          ctx.font = 50+"px Impact";
          if(gameState == 'death'){
            ctx.fillText("YOU DIED",px-90,150);
          }
          else if (gameState == 'win'){
            ctx.fillText("Level Complete",px-160,150);
          }
          ctx.font = "30px audiowide";
          ctx.fillText("Best Time: "+secToTime(bestTime[level-2]),px-150,200);
          ctx.fillText("Time: "+secToTime(timer[level-2]),(particle[i][1]-90)*px/25-115,250);
          ctx.fillText("(Click to continue)",(particle[i][1]-115)*px/25-150,py*2-150);
        }
        else if (particle[i][1]<=140){
          click = false;
          ctx.fillStyle = "#00e677";
          ctx.fillRect(0,0,px,2*py);
          ctx.fillStyle = "#d81b60";
          ctx.fillRect(px,0,px,2*py);
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(50,50,2*px-100,2*py-100);
          ctx.fillStyle = "#000000";
          ctx.font = 50+"px Impact";
          if(gameState == 'death'){
            ctx.fillText("YOU DIED",px-90,150);
          }
          else if (gameState == 'win'){
            ctx.fillText("Level Complete",px-160,150);
          }
          ctx.font = "30px audiowide"
          ctx.fillText("Best Time: "+secToTime(bestTime[level-2]),px-150,200);
          ctx.fillText("Time: "+secToTime(timer[level-2]),px-115,250);
          ctx.fillText("(Click to continue)",(particle[i][1]-115)*px/25-150,py*2-150);
        }
        else if (particle[i][1]<=1000){
          ctx.fillStyle = "#00e677";
          ctx.fillRect(0,0,px,2*py);
          ctx.fillStyle = "#d81b60";
          ctx.fillRect(px,0,px,2*py);
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(50,50,2*px-100,2*py-100);
          ctx.fillStyle = "#000000";
          ctx.font = 50+"px Impact";
          if(gameState == 'death'){
            ctx.fillText("YOU DIED",px-90,150);
          }
          else if (gameState == 'win'){
            ctx.fillText("Level Complete",px-160,150);
          }
          ctx.font = "30px audiowide"
          ctx.fillText("Best Time: "+secToTime(bestTime[level-2]),px-150,200);
          ctx.fillText("Time: "+secToTime(timer[level-2]),px-115,250);
          ctx.fillText("(Click to continue)",px-150,py*2-150);
          if (click == true){
            click = false;
            particle.splice(i,1);
            gameState = false;
            dying = false;
            //smtoken -= 1;
          }
        }
        else {
          click = false;
          particle.splice(i,1);
          gameState = false;
          dying = false;
        }
      }
    }
  
    /*if (entity.length > 0){
      ctx.globalAlpha=0.5;
      ctx.fillStyle = '#cccccc'
      ctx.fillRect(0,0, canvas.width, canvas.height);
      ctx.globalAlpha=1;*/
    if (o2 == true){
      ctx.beginPath();
      ctx.moveTo(px-1000+10,py-500+10);
      ctx.lineTo(px+10,py+10);
      ctx.moveTo(px+1000+10,py-500+10);
      ctx.lineTo(px+10,py+10);
      ctx.moveTo(px+10,py+10);
      ctx.lineTo(px+10,py+500+10);
      ctx.moveTo(px+10,py+10);
      ctx.lineTo(px+500+10,py-1000+10);
      ctx.moveTo(px+10,py+10);
      ctx.lineTo(px-500+10,py-1000+10);
  
      ctx.stroke();
      kineticDisplay(1,-1);
    }
    if (dialouget != 0){
      if (canvas.width<=400){
        canvas.width = 410;
      }
      if(dialouget == 1){
        temp = smtext;
      }
      if(dialouget == 2){
        temp = smtext2;
      }
      if (temp[dialougei][dialougej-1]=='-'){
        ctx.fillStyle = "#696969";
        ctx.fillRect(canvas.width/2-210,0,420,60);
        ctx.fillStyle = "#cccccc";
        ctx.fillRect(canvas.width/2-200,10,400,40);
        ctx.fillStyle = "#ffffff"
        ctx.fillRect(canvas.width/2-160,15,350,30);
        ctx.drawImage(skin,canvas.width/2-190,20);
        ctx.fillStyle = "#000000";
        ctx.fillText(temp[dialougei][dialougej],canvas.width/2-150,37.5);
      }
      else {
        ctx.fillStyle = "#696969";
        ctx.fillRect(canvas.width/2-210,0,420,65);
        ctx.fillStyle = "#cccccc";
        ctx.fillRect(canvas.width/2-200,10,400,45);
        ctx.fillStyle = "#ffffff"
        ctx.fillRect(canvas.width/2-155,15,350,35);
        drawPlayer(canvas.width/2-190,20,dialougei);
        ctx.fillStyle = "#000000";
        ctx.fillText(temp[dialougei][dialougej],canvas.width/2-145,40);
      }
    }
    //entitydisplay
    if (entity.length > 0){
      kineticDisplay(1,-1);
    }
  }
  
  function drawPlayer(varx,vary,typez){
    ctx.fillStyle = "hsla("+(typez*190)%260+",100%,50%)";
    ctx.fillRect(varx,vary,25,25);
    ctx.strokeStyle = "hsla("+(typez*190)%260+",100%,45%)";
    ctx.strokeRect(varx+1,vary+1,23,23);
    ctx.strokeStyle = "hsla("+(typez*190)%260+",100%,40%)";
    ctx.strokeRect(varx,vary,25,25);
    //hats
    ctx.drawImage(entityTextureMap,entityTextureMapX[typez]*25,0, 25, 50, varx, vary-25,25,50);
  }                     /*(entityTextureMapX[typez]%10)*25*//*(entityTextureMapX[typez]-entityTextureMapX[typez]%10)*5*/

  function getRandomInt(max) {
    return Math.floor(Math.random() * max + 1);
  }
  
  function keyUpdate(){
    if (map[68] || map[39]){
      if (velocity2 < run && dying == false){
        velocity2 += 0.1;
      }
      look = 'right';
    }
    else if (map[65] || map[37]){
      if (velocity2 > -1*run && dying == false){
        velocity2 -= 0.1;
      }
      look = 'left';
    }
    else{
      if (gameState == 'play'){
        if (velocity2 < -0.075){
          velocity2 += 0.15;
        }
        else if (velocity2 > 0.075){
          velocity2 -= 0.15;
        }
        else {
          velocity2 = 0;
        }
      }
    }
    lx+=velocity2;
    if ((map[87] || map[38])&& falling == false){
      velocity = jump;
    }
    if (attack == 0 &&(map[83] || map[40])){
      if (attackType == 1){
        summon(-1,0,0,0);
        attack += 10;//80
      }
      else if (attackType == 2){
        summon(-2,0,0,0);
        attack += 80;
      }
    }
  }
  
  function collect(i){
  
    if (pT[i] == 12){
      coins += 10;
      resetStats()
      terminalVelocity = -2;
      effect = 3;
    }
    if (pT[i] == 11){
      coins += 10;
      resetStats()
      jump = 9;
      effect = 2;
    }
    if (pT[i] == 10){
      coins += 5;
      resetStats()
      run = 4;
      effect = 1;
    }
    if (pT[i] == 9){
      coins += 1
      resetStats()
      effect = 0;
    }
    pT.splice(i,1);
    pY.splice(i,1);
    pX.splice(i,1);
  }
  
  function resetStats(){
    jump = 7.2;
    run = 2.5;
    terminalVelocity = -5;
  }
  function levelSet(){
      coins = 0;
      entity = [];
      if (gameState == 'win'){
        smLevelStat[Math.floor(level)-1] += 1;
        for(let k = 0; k <= smtext.length; k++){
          smToken[k] = 0;
        }
        particlize(10);
      }
      else if (levelType == 1){
        genLevelStat[level-1] += 1;
        timer[level-1]=0;
        menu = false
        pX = genLevelX[level-1].map((x) => x);
        pY = genLevelY[level-1].map((x) => x);
        pT = genLevelT[level-1].map((x) => x);
        tc = genLevelTc[level-1];
        jump = 7.2;
        run = 2.5;
        terminalVelocity = -5;
        effect = 0;
      }
      else if (levelType == 2){
        menu = true
        pX = newLevelX[level-1].map((x) => x);
        pY = newLevelY[level-1].map((x) => x);
        pT = newLevelT[level-1].map((x) => x);
        tc = newLevelTc[level-1];
        jump = 7.2;
        run = 2.5;
        terminalVelocity = -5;
        effect = 0;
      }
      else if (levelType == 2.9){
        menu = false
        pX = smX[level-1].map((x) => x);
        pY = smY[level-1].map((x) => x);
        pT = smT[level-1].map((x) => x);
        tc = smTc[level-1];
        jump = 7.2;
        run = 2.5;
        terminalVelocity = -5;
        effect = 0;
      }
  }
  
  
  function build(canvas, event, building, yn) {
    const rect = canvas.getBoundingClientRect();
    let x = event.clientX - rect.left + lx;
    let y = event.clientY - rect.top - py - 20;
  
    bX = (x - x % 50) / 50;
    if (x < 0){
      bX -= 1;
    }
    bY = ((y - y % 50) / -50) + height;
    if (y < 0){
      bY += 1;
    }
    x -= lx;
    y += py + 20;
  if (yn == 'no'){
    click = true;
    if (dialouget != 0){
      if(dialouget == 1){
        temp = smtext;
      }
      if(dialouget == 2){
        temp = smtext2;
      }
      //sm sytnax
      if (temp[dialougei].length-1 == dialougej){
        dialouget = 0;
      }
      else if (temp[dialougei][dialougej+1] == "-"){
        dialougej += 2;
      }
      else if (temp[dialougei][dialougej+1] == "-t"){
        smToken[temp[dialougei][dialougej+2]] = 1;
        dialougej += 3;
      }
      else if (temp[dialougei][dialougej+1] == "-v"){
        str[temp[dialougei][dialougej+2]] += 1;
        dialougej += 3;
      }
      else if (temp[dialougei][dialougej+1] == "-c"){
        coins += temp[dialougei][dialougej+2];
        if(dialouget == 1){
          smtext[dialougei].splice(dialougej+1,2);
        }
        if(dialouget == 2){
          smtext2[dialougei].splice(dialougej+1,2);
        }
        dialougej += 1;
      }
      else if (temp[dialougei][dialougej+1] == "-!b"){
        collect(temp[dialougei][dialougej+2]);
        if(dialouget == 1 || dialouget == 2){
          smtext[dialougei].splice(dialougej+1,2);
        }
        dialougej += 1;
      }
      else if (temp[dialougei][dialougej+1] == "-!t"){
        smToken[temp[dialougei][dialougej+2]] = 0;
        dialougej += 3;
      }
      else {
        dialougej += 1;
      }
      if (temp[dialougei].length == dialougej){
        dialouget = 0;
      }
    }
    //menu scroll
    if (menu == true && x > 122 && x < canvas.width - 122 && y > 0 && y < 64){
        tv = (x-72 - (x-72)%55)/55 - menuScroll
        if (tv == 1){
          type = 1;
        }
        else if (tv == 2){
          type = 1.1;
        }
        else if (tv == 3){
          type = 1.5;
        }
        else if (tv == 4){
          type = 2;
        }
        else if (tv == 5){
          type = 3;
        }
        else if (tv == 6){
          type = 3.2;
        }
        else if (tv == 7){
          type = 3.3;
        }
        else if (tv == 8){
          type = 3.4;
        }
        else if (tv == 18){
          dev = !dev;
        }
        else if (tv == 19){
          type = 20;
        }
        else if (tv == 20){
          type = 21;
        }
        else if (tv == 21){
          type = 99;
        }
        else {
          type = tv - 5;
        }
      }
      else if (menu == true && x > 100 && x < 122 && y > 0 && y < 64){
        if (menuScroll < 0){
          menuScroll += 1;
        }
      }
      else if (menu == true && x > canvas.width - 122 && x < canvas.width - 100 && y > 0 && y < 64){
        if (1062+55*menuScroll >= canvas.width-172){
          //677
          menuScroll -= 1;
        }
      }
  }
    if (dev == true){
      newLevelTc[newLevelTc.length-1] = Number(input.value)
      levelSet();
      if (x > 100 && x < canvas.width - 100 && y > 0 && y < 64){
        //here for later :D
      }
      else if (menu == true){
        if (building == true){
          if (type == 9 || type == 20 || type == 21){
            x += lx;
            y -= py + 20;
            bX = (x - x % 25) / 50;
            if (x < 0){
              bX -= 0.5;
            }
            bY = ((y - y % 25) / -50) + height;
            if (y < 0){
              bY += 0.5;
            }
            x -= lx;
            y += py + 20;
          }
          if (yn == 'no'){
            newLevelX[newLevelX.length-1].push(bX);
            newLevelY[newLevelY.length-1].push(bY);
            newLevelT[newLevelT.length-1].push(type);
            levelSet();
          }
        }
        else if (building == false && yn == 'no'){
          newLevelX[newLevelX.length-1].splice(newLevelX[newLevelX.length-1].length-2,2);
          newLevelY[newLevelY.length-1].splice(newLevelY[newLevelY.length-1].length-2,2);
          newLevelT[newLevelT.length-1].splice(newLevelT[newLevelT.length-1].length-2,2);
          levelSet();
        }
      }
      if (menu == false && yn == 'no'){
        if (building == true){
          newLevelX[newLevelX.length-1].push(bX);
          newLevelY[newLevelY.length-1].push(bY);
          newLevelT[newLevelT.length-1].push(type);
        }
        else if (building == false){
          newLevelX[newLevelX.length-1].splice(newLevelX[newLevelX.length-1].length-2,2);
          newLevelY[newLevelY.length-1].splice(newLevelY[newLevelY.length-1].length-2,2);
          newLevelT[newLevelT.length-1].splice(newLevelT[newLevelT.length-1].length-2,2);
          levelSet();
        }
        levelSet();
      }
    }
    if (gameState == false && yn == 'no') {
      if (tab == "time"){
        for (let i = 1; i < genLevelX.length+1; i++) {
          if (100 > i*110+50+110*genLevelS-x && i*110+50+110*genLevelS-x > 0 && -140 < 270-y && 270-y < 0 && (genLock[i-1] == 1 || genLock[i-1] == 2)){
            lx = 0-window.innerWidth/2;
            ly = 0-window.innerHeight/2;
            py = -ly;
            px = -lx;
            fall = true;
            falling = true;
            onblock = 0;
            onright = 0;
            onleft = 0;
            velocity = -1 
            gameState = 'play';
            levelType = 1;
            level = i;
            levelSet();
          }
        }
      }
      else if (tab == "edit"){
        for (let i = 1; i < newLevelX.length+1; i++) {
          if (100 > i*110+50+110*newLevelS-x && i*110+50+110*newLevelS-x > 0 && -140 < 270-y && 270-y < 0 && (newLock[i-1] == 1 || newLock[i-1] == 2)){
            if (newLock[i-1] == 2){
              createNewLevel();
              console.log('hi');
            }
            else{
              lx = 0-window.innerWidth/2;
              ly = 0-window.innerHeight/2;
              py = -ly;
              px = -lx;
              fall = true;
              falling = true;
              onblock = 0;
              onright = 0;
              onleft = 0;
              velocity = -1
              gameState = 'play';
              levelType = 2;
              level = i;
              levelSet();
            }
          }
        }
      }
      else if (tab == "fight"){
        for (let i = 1; i < smX.length+1; i++) {
          if (100 > i*110+50+110*smS-x && i*110+50+110*smS-x > 0 && -140 < 270-y && 270-y < 0 && (smLock[i-1] == 1 || smLock[i-1] == 2)){
            lx = 0-window.innerWidth/2;
            ly = 0-window.innerHeight/2;
            py = -ly;
            px = -lx;
            fall = true;
            falling = true;
            onblock = 0;
            onright = 0;
            onleft = 0;
            velocity = -1;
            gameState = 'play';
            levelType = 2.9;
            level = i;
            levelSet();
          }
        }
      }
    }
  }
  
  canvas.addEventListener('mousedown', function (e) { build(canvas, e, true, 'no') })
  canvas.addEventListener('mousemove', function (e) { build(canvas, e, true, 'yes') })
  canvas.addEventListener('touchmove', function (e){ touchScreen(canvas, e) }, {passive: true})
  canvas.addEventListener('touchstart', function (e){ touchScreen(canvas, e) }, {passive: true})
  
  canvas.addEventListener('touchend', function (){ tapfalse() });
  
  function tapfalse(){
    map[37] = false;
    map[39] = false;
    map[38] = false;
  }
  
  function touchScreen(canvas, e){
    click = true;
    let evt = (typeof e.originalEvent === 'undefined') ? e : e.originalEvent;
    let touch = evt.touches[evt.touches.length-1] || evt.changedTouches[evt.touches.length-1];
    const rect = canvas.getBoundingClientRect();
    let x = touch.clientX - rect.left - px - 10;
    let y = touch.clientY - rect.top - py - 10;
        
    if (y>=0 && x>0){
      map[39] = true;
      map[37] = false;
      map[38] = false;
    }
    if (y>=0 && x<0){
      map[37] = true;
      map[39] = false;
      map[38] = false;
    }
    if(y<0 && x>0){
      if(-1*y/x<1/2){
        map[39] = true;
        map[37] = false;
        map[38] = false;
      }
      if(-1*y/x>=1/2 && -1*y/x<=2){
        map[39] = true;
        map[38] = true;
        map[37] = false;
      }
      if(-1*y/x>2){
        map[38] = true;
      }
    }
    if(y<0 && x<0){
      if(y/x<1/2){
        map[37] = true;
        map[39] = false;
        map[38] = false;
      }
      if(y/x>=1/2 && -1*y/x<=2){
        map[37] = true;
        map[38] = true;
        map[39] = false;
      }
      if(y/x>2){
        map[38] = true;
      }
    }
  } 
  function clearScreen(){
    pX = [0];
    pY = [0];
    pT = [1];
  }
  function clicked(i){
    if (i == 1){
      type = 1;
    }
    else if (i == 2){
      type = 2;
    }
    else if (i == 3){
      type = 3;
    }
    else if (i == 4){
      type = 4;
    }
    else if (i == 5){
      type = 5;
    }
    else if (i == 6){
      type = 6;
    }
    else if (i == 7){
      type = 9;
    }
    else if (i == 8){
      type = 10;
    }
    else if (i == 9){
      type = 11;
    }
    else if (i == 10){
      type = 7;
    }
    else if (i == 11){
      type = 12;
    }
    else if (i == 13){
      type = 8;
    }
    console.log(i);
  }
  
  function exportLevel() {
    navigator.clipboard.writeText('[' + pX + '],[' + pY + '],[' + pT + ']');
    alert('[' + pX + '],[' + pY + '],[' + pT + '] has been copied to clipboard');
  }
  function playLevel() {
    dev = false;
    tc = 0;
    buttonDiv.style.display = 'none';
  }
  function createNewLevel() {
    gameState = 'play';
    dev = true;
    menu = true;
    clearScreen();
    buttonDiv.style.display = 'block';
    newLevelX.push([0,1]);
    newLevelY.push([1,1]);
    newLevelT.push([1,1]);
    newLevelTc.push(0);
    newLock.push(1);
    level = newLevelX.length;
    levelType = 2;
    levelSet();
    velocity = 0;
    ly -= 50;
  }
  function arrows(i) {
    if (i == 'skillRight'){
      if (110*genLevelX.length+110*genLevelS <= canvas.width-50){
        genLevelS += 0;
      }
      else {
        genLevelS -= 1
      }
    }
    else if (i == 'skillLeft'){
      if (genLevelS == 0){
        genLevelS = 0
      }
      else {
        genLevelS += 1
      }
    }
    if (i == 'newRight'){
      if (110*newLevelX.length+110*newLevelS <= canvas.width-50){
        newLevelS = newLevelS
      }
      else {
        newLevelS -= 1
      }
    }
    else if (i == 'newLeft'){
      if (newLevelS == 0){
        newLevelS = 0
      }
      else {
        newLevelS += 1
      }
    }
    if (i == 'smRight'){
      if (110*smX.length+110*smS <= canvas.width-50){
        smS = smS
      }
      else {
        smS -= 1
      }
    }
    else if (i == 'smLeft'){
      if (smS == 0){
        smS = 0
      }
      else {
        smS += 1
      }
    }
  }
  document.addEventListener('contextmenu', event => {event.preventDefault(); build(canvas,event,false,'no'); });
  
  window.addEventListener("beforeunload", function (e) {
      if (o1 == true){
        updateLocalStorage();
      }
      if (dev==true || o1 == false) {
        let confirmationMessage = 'It looks like you have created level(s). If you leave before saving, your changes will be lost.';
        (e || window.event).returnValue = confirmationMessage; //Gecko + IE
        return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
      }
  });
  
  
  //entities
  function summon(type, varx, vary, i){
    if (type == 1){
      entity.push([1,varx*50,(-50)*vary+85*zy,0,i]);
    }
    else if (type == 2){
      entity.push([2,varx*50-5,(-50)*vary+85*zy-5,0,i,0]);
    }
    else if (type == 3){
      entity.push([3,varx*50,(-50)*vary+85*zy,0,0,100]);
    }
    else if (type == 3.1){
      entity.push([3.1,varx,0]);
    }
    else if (type == 3.2){
      entity.push([3.2,varx,vary,i]);
    }
    else if (type == -1){
      entity.push([-1,lx+px,ly+py,i]);
    }
    else if (type == -2){
      entity.push([-2,lx+px+12,ly+py+12,0]);
    }
  }

  function secToTime(frames) {
  let returnTimeString = '';
  let sec = frames/80;
  let counterTime = 0;
  // Days
  if (sec >= 604800) {
    counterTime = (sec - (sec % 604800)) / 604800;
    returnTimeString += counterTime + 'wk ';
    sec -= counterTime * 604800;
  }
  if (sec >= 86400) {
    counterTime = (sec - (sec % 86400)) / 86400;
    returnTimeString += counterTime + 'd ';
    sec -= counterTime * 86400;
  }
  // Hours
  if (sec >= 3600) {
    counterTime = (sec - (sec % 3600)) / 3600;
    returnTimeString += counterTime + 'h ';
    sec -= counterTime * 3600;
  }
  // Minutes
  if (sec >= 60) {
    counterTime = (sec - (sec % 60)) / 60;
    returnTimeString += counterTime + 'm ';
    sec -= counterTime * 60;
  }
  // Seconds
  returnTimeString += Math.round(sec*100)/100 + 's';
  return returnTimeString;
}

function tabs(evt, num){
  let tabl = document.getElementsByClassName("sb");
  for (i = 0; i < tabl.length; i++) {
    tabl[i].className = tabl[i].className.replace(" active", "");
  }
  evt.currentTarget.className += " active";
  if (num == 1){
    tab = "fight";
  }
  else if (num == 2){
    tab = "idle";
  }
  else if (num == 3){
    //tabl[2].className = tabl[2].className.replace(" active", "");
    tab = "defeat";
  }
  else if (num == 4){
    tab = "gravity";
  }
  else if (num == 5){
    tab = "edit";
  }
  else if (num == 6){
    tab = "time";
  }
}

function updateLocalStorage(){
  localStorage.setItem('genLock',JSON.stringify(genLock));
  localStorage.setItem('bestTime',JSON.stringify(bestTime));
  localStorage.setItem('genLevelStat',JSON.stringify(genLevelStat));
}
function clearLocalStorage(){
  localStorage.removeItem('bestTime');
  localStorage.removeItem('genLevelStat');
  localStorage.removeItem('genLock');
  location.reload();
}
